<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>PlayFramework快速入门 | zqhxuyuan</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player   Run! Run!! Run!!! Hello World! 路由和Controller 页面和渲染 模板编译     Products Example implicit   Spark集成 play-spark-module Spark Launc">
<meta name="keywords" content="scala">
<meta property="og:type" content="article">
<meta property="og:title" content="PlayFramework快速入门">
<meta property="og:url" content="http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/index.html">
<meta property="og:site_name" content="zqhxuyuan">
<meta property="og:description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player   Run! Run!! Run!!! Hello World! 路由和Controller 页面和渲染 模板编译     Products Example implicit   Spark集成 play-spark-module Spark Launc">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111154235071">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111154733495">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111170901722">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111170829019">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161118100439795">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161118100453598">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161125100527204">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161125100553908">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161129174641219">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512105246182">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512103522643">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512103539643">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512104754468">
<meta property="og:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512105802005">
<meta property="og:updated_time" content="2019-02-14T13:42:29.379Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="PlayFramework快速入门">
<meta name="twitter:description" content="Scala PlayFramework（2.4）入门示例程序：https://github.com/zqhxuyuan/first-player   Run! Run!! Run!!! Hello World! 路由和Controller 页面和渲染 模板编译     Products Example implicit   Spark集成 play-spark-module Spark Launc">
<meta name="twitter:image" content="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111154235071">
  
    <link rel="alternative" href="/atom.xml" title="zqhxuyuan" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/font-awesome/css/font-awesome.min.css">
  <link rel="apple-touch-icon" href="/apple-touch-icon.png">
</head></html>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">任何忧伤,都抵不过世界的美丽</a></h1>
		</hgroup>

		
				


		
			<div id="switch-btn" class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
						<div class="icon-wrap icon-me hide" data-idx="3">
							<div class="user"></div>
							<div class="shoulder"></div>
						</div>
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
						<li>关于我</li>
						
					</ul>
				</div>
			</div>
		

		<div id="switch-area" class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives/">归档</a></li>
				        
							<li><a href="/tags/">标签</a></li>
				        
							<li><a href="/about/">关于</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/apex/" style="font-size: 10px;">apex</a> <a href="/tags/bigdata/" style="font-size: 10px;">bigdata</a> <a href="/tags/book/" style="font-size: 10px;">book</a> <a href="/tags/cassandra/" style="font-size: 18.89px;">cassandra</a> <a href="/tags/clojure/" style="font-size: 10px;">clojure</a> <a href="/tags/drill/" style="font-size: 16.67px;">drill</a> <a href="/tags/druid/" style="font-size: 13.33px;">druid</a> <a href="/tags/dubbo/" style="font-size: 10px;">dubbo</a> <a href="/tags/elasticsearch/" style="font-size: 10px;">elasticsearch</a> <a href="/tags/etl/" style="font-size: 10px;">etl</a> <a href="/tags/geode/" style="font-size: 10px;">geode</a> <a href="/tags/graph/" style="font-size: 12.22px;">graph</a> <a href="/tags/hadoop/" style="font-size: 11.11px;">hadoop</a> <a href="/tags/hbase/" style="font-size: 15.56px;">hbase</a> <a href="/tags/ignite/" style="font-size: 10px;">ignite</a> <a href="/tags/java/" style="font-size: 10px;">java</a> <a href="/tags/jvm/" style="font-size: 10px;">jvm</a> <a href="/tags/kafka/" style="font-size: 20px;">kafka</a> <a href="/tags/midd/" style="font-size: 10px;">midd</a> <a href="/tags/ops/" style="font-size: 12.22px;">ops</a> <a href="/tags/redis/" style="font-size: 11.11px;">redis</a> <a href="/tags/rocketmq/" style="font-size: 10px;">rocketmq</a> <a href="/tags/scala/" style="font-size: 13.33px;">scala</a> <a href="/tags/spark/" style="font-size: 17.78px;">spark</a> <a href="/tags/storm/" style="font-size: 17.78px;">storm</a> <a href="/tags/tcc/" style="font-size: 10px;">tcc</a> <a href="/tags/timeseries/" style="font-size: 12.22px;">timeseries</a> <a href="/tags/work/" style="font-size: 14.44px;">work</a> <a href="/tags/流处理/" style="font-size: 11.11px;">流处理</a>
					</div>
				</section>
				
				
				

				
				
				<section class="switch-part switch-part3">
				
					<div id="js-aboutme">BIG(DATA)</div>
				</section>
				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<a href="/" class="profilepic">
				<img lazy-src="https://avatars1.githubusercontent.com/u/1088525?v=3&amp;s=180" class="js-avatar">
			</a>
			<hgroup>
			  <h1 class="header-author"><a href="/" title="回到主页">任何忧伤,都抵不过世界的美丽</a></h1>
			</hgroup>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives/">归档</a></li>
		        
					<li><a href="/tags/">标签</a></li>
		        
					<li><a href="/about/">关于</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
						<ul class="social">
							
								<li id="新浪微博"><a class="新浪微博" target="_blank" href="http://weibo.com/xuyuantree" title="新浪微博"></a></li>
					        
								<li id="GitHub"><a class="GitHub" target="_blank" href="http://github.com/zqhxuyuan" title="GitHub"></a></li>
					        
								<li id="RSS"><a class="RSS" target="_blank" href="/atom.xml" title="RSS"></a></li>
					        
						</ul>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-Play-Quickstart" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/11/11/Play-Quickstart/" class="article-date">
  	<time datetime="2016-11-10T16:00:00.000Z" itemprop="datePublished">2016-11-11</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      PlayFramework快速入门
    </h1>
  

      </header>
      
      <div class="article-info article-info-post">
        
	<div class="article-category tagcloud">
	<a class="article-category-link" href="/categories/scala/">scala</a>
	</div>


        
	<div class="article-tag tagcloud">
		<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/scala/">scala</a></li></ul>
	</div>

        <div class="clearfix"></div>
      </div>
      
    
    <div class="article-entry" itemprop="articleBody">
      
        
        <p>Scala PlayFramework（2.4）入门<br>示例程序：<a href="https://github.com/zqhxuyuan/first-player">https://github.com/zqhxuyuan/first-player</a></p>
<!-- MarkdownTOC -->
<ul>
<li>Run! Run!! Run!!!</li>
<li>Hello World!<ul>
<li>路由和Controller</li>
<li>页面和渲染<ul>
<li>模板编译</li>
</ul>
</li>
</ul>
</li>
<li>Products Example<ul>
<li>implicit</li>
</ul>
</li>
<li>Spark集成<ul>
<li>play-spark-module</li>
<li>Spark Launcher<ul>
<li>mesos</li>
<li>问题</li>
</ul>
</li>
<li>Spark Cassandra</li>
<li>预览</li>
<li>Actor</li>
<li>Quartz<ul>
<li>Job依赖注入</li>
<li>Quartz作业的自动重启</li>
</ul>
</li>
<li>Kafka</li>
</ul>
</li>
<li>附录<ul>
<li>sbt私服</li>
<li>Play MultiProject</li>
<li>Run &amp; Debug With IDEA<ul>
<li><ol>
<li>Play App（❌）</li>
</ol>
</li>
<li><ol start="2">
<li>Sbt Task（✅）</li>
</ol>
</li>
<li><ol start="3">
<li>jvm-debug（✅）</li>
</ol>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<!-- /MarkdownTOC -->
<a id="more"></a>
<h1 id="Run!_Run!!_Run!!!">Run! Run!! Run!!!</h1><p><strong>安装activator</strong>  </p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">brew install typesafe-activator</span><br><span class="line">activator new first-player</span><br><span class="line"><span class="built_in">cd</span> first-player</span><br><span class="line">activator run</span><br></pre></td></tr></table></figure>
<p><strong>导入IntelliJ IDEA</strong>  </p>
<ol>
<li>install IDEA professional</li>
<li>install PlayFramework support</li>
<li>import SBT project</li>
<li>right click controllers.Products, Run Play2 App in idea</li>
</ol>
<h1 id="Hello_World!">Hello World!</h1><p><code>activator new first-player</code>生成的目录结构如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">➜  first-player tree -L 2</span><br><span class="line">.</span><br><span class="line">├── activator                   使用activator new才有该文件</span><br><span class="line">├── activator-launch-1.3.4.jar</span><br><span class="line">├── app </span><br><span class="line">│   ├── controllers             控制器</span><br><span class="line">│   ├── models                  模型</span><br><span class="line">│   └── views                   视图（Web页面）</span><br><span class="line">├── build.sbt</span><br><span class="line">├── conf</span><br><span class="line">│   ├── application.conf        配置文件</span><br><span class="line">│   └── routes                  路由配置</span><br><span class="line">├── project</span><br><span class="line">│   ├── build.properties</span><br><span class="line">│   ├── plugins.sbt             插件配置</span><br><span class="line">├── public                      样式和脚本</span><br><span class="line">│   ├── images</span><br><span class="line">│   ├── javascripts</span><br><span class="line">│   └── stylesheets</span><br></pre></td></tr></table></figure>
<h2 id="路由和Controller">路由和Controller</h2><p>路由配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># http://localhost:9000</span><br><span class="line">GET     /                           controllers.HomeController.index</span><br><span class="line"></span><br><span class="line"># http://localhost:9000/hello?n=Play!</span><br><span class="line">GET     /hello                      controllers.HomeController.hello(n: String)</span><br></pre></td></tr></table></figure>
<p>对应的HomeController方法：</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.inject._</span><br><span class="line"><span class="keyword">import</span> models.<span class="type">Product</span></span><br><span class="line"><span class="keyword">import</span> play.api._</span><br><span class="line"><span class="keyword">import</span> play.api.mvc._</span><br><span class="line"></span><br><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HomeController</span> <span class="title">@Inject</span>(<span class="params"></span>) <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">index</span> </span>= <span class="type">Action</span> &#123;</span><br><span class="line">    <span class="type">Ok</span>(views.html.index(<span class="string">"Your new application is ready."</span>))  <span class="comment">//①</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">hello</span></span>(name: <span class="type">String</span>) = <span class="type">Action</span> &#123;</span><br><span class="line">    <span class="comment">//Ok("Hello " + name)</span></span><br><span class="line">    <span class="type">Ok</span>(views.html.hello(name))  <span class="comment">//②</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>①：index方法的Response响应会返回一个Html页面，指向<code>app/views/index.scala.html</code>页面<br>②：hello方法的响应返回<code>app/views/hello.scala.html</code>页面，只不过这个页面会渲染一个参数</p>
<blockquote>
<p>注：如果Controller的Action方法是Ok(“字符串”)则返回的是一个字符串。<br>2.2版本中Controller可以用object，在2.4需要用class，以及@Inject和@Singleton</p>
</blockquote>
<p>本节知识点：</p>
<ol>
<li>路由配置到控制器的映射</li>
<li>Action的Response返回值如何指向页面</li>
<li>Action的参数如何传递给页面</li>
</ol>
<h2 id="页面和渲染">页面和渲染</h2><p>views是Play的html页面，也可以在该页面下新建子目录。在IntelliJ中，在views下创建子目录，<br>也是创建一个Package，，因为views和controllers的等级相同。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">➜  app tree views</span><br><span class="line">views</span><br><span class="line">├── hello.scala.html</span><br><span class="line">├── index.scala.html</span><br><span class="line">├── main.scala.html</span><br><span class="line">├── products</span><br><span class="line">│   ├── details.scala.html</span><br><span class="line">│   ├── edit.scala.html</span><br><span class="line">│   ├── list.scala.html</span><br><span class="line">│   └── main.scala.html</span><br></pre></td></tr></table></figure>
<p>app/views/index.scala.html：index方法中的”Your new application is ready.”<br>会传递到index.scala.html作为第一行的message参数。  </p>
<p>@main调用的是同一个路径的main.scala.html模板页面，也可以用@views.html.main绝对路径。<br>Play的scala.html页面实际上是模板，可以用Scala代码的方式来调用。<br>所以@main方法的第一参数是字符串（标题），第二个参数是Html对象用来表示page body。<br>@play20.welcome是Play内置的一个方法（绝对路径是@views.html.play20）</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@(message: String)</span><br><span class="line"></span><br><span class="line">@main("Welcome to Play") &#123;</span><br><span class="line">    @play20.welcome(message, style = "Scala")</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的@main方法会调用同路径的main.scala.html模板页面（Layout嵌套）。<br>app/views/main.scala.html：第一行有两个参数，而且是参数列表的方式，而不是两个参数放在一起。  </p>
<p>index页面的”Welcome to Play”作为title参数，第二个参数则作为content参数，正好对应了Html类型。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@(title: String)(content: Html)</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>@title<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span> <span class="attr">media</span>=<span class="string">"screen"</span> <span class="attr">href</span>=<span class="string">"@routes.Assets.versioned("</span><span class="attr">stylesheets</span>/<span class="attr">main.css</span>")"&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">"shortcut icon"</span> <span class="attr">type</span>=<span class="string">"image/png"</span> <span class="attr">href</span>=<span class="string">"@routes.Assets.versioned("</span><span class="attr">images</span>/<span class="attr">favicon.png</span>")"&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        @content</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>两个参数放在一起的话，类似：@(title: String, content: Html)。对应的调用方式也要更改为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@main(&quot;Welcome to Play&quot;, &#123;</span><br><span class="line">    @play20.welcome(message, style = &quot;Scala&quot;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>本节知识点：</p>
<ol>
<li>views子目录的创建，以及在控制器中如何访问到指定子目录下的页面</li>
<li>页面的参数定义和使用（@标记后面的都是Scala代码），参数列表</li>
<li>嵌套模板的使用，对应的Scala方法</li>
<li>缺省的模板调用路径是和当前页面相同路径，绝对路径是<a href="mailto:`@views.html" target="_blank" rel="noopener">`@views.html</a>.`</li>
</ol>
<h3 id="模板编译">模板编译</h3><p>views下的每个页面都会被编译成Scala的模板类，下面右图views.html实际上就和控制器的调用是类似的。  </p>
<blockquote>
<p>如果是其他格式，比如json、xml，则用views.json或者views.xml，可见不总是views.html。</p>
</blockquote>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111154235071" alt="play vies"></p>
<p>HomeController的idnex方法</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span> </span>= <span class="type">Action</span> &#123;</span><br><span class="line">  <span class="type">Ok</span>(views.html.index(<span class="string">"Your new application is ready."</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译后的文件路径：target/scala-2.11/twirl/main/views.html/index.template.scala<br>index是一个object，对应index类的apply方法，接收一个参数，参数名称为message。</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">index_Scope0</span> </span>&#123;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">index</span>  </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(message: <span class="type">String</span>):play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = &#123;...&#125;</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">render</span></span>(message:<span class="type">String</span>): play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = apply(message)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>:((<span class="type">String</span>) =&gt; play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span>) = (message) =&gt; apply(message)</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">ref</span></span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="keyword">this</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">index</span> <span class="keyword">extends</span> <span class="title">index_Scope0</span>.<span class="title">index</span></span></span><br></pre></td></tr></table></figure>
<p>index.scala.html调用@main方法对应的views/main.scala.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@(message: String)</span><br><span class="line">@main(&quot;Welcome to Play&quot;) &#123;</span><br><span class="line">    @play20.welcome(message, style = &quot;Scala&quot;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>main方法对应的编译文件：target/scala-2.11/twirl/main/views.html/main.template.scala<br>main类的apply方法有两个参数，分别是(title: String)(content: Html)</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">main_Scope0</span> </span>&#123;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">main</span> </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">apply</span></span>(title: <span class="type">String</span>)(content: <span class="type">Html</span>):play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = &#123; ... &#125;</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">render</span></span>(title:<span class="type">String</span>,content:<span class="type">Html</span>): play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span> = apply(title)(content)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">f</span></span>:((<span class="type">String</span>) =&gt; (<span class="type">Html</span>) =&gt; play.twirl.api.<span class="type">HtmlFormat</span>.<span class="type">Appendable</span>) = (title) =&gt; (content) =&gt; apply(title)(content)</span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">ref</span></span>: <span class="keyword">this</span>.<span class="keyword">type</span> = <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">main</span> <span class="keyword">extends</span> <span class="title">main_Scope0</span>.<span class="title">main</span></span></span><br></pre></td></tr></table></figure>
<h1 id="Products_Example">Products Example</h1><p>路由配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">POST    /products                      controllers.Products.save</span><br><span class="line">GET     /products/new                  controllers.Products.newProduct</span><br><span class="line">GET     /products                      controllers.Products.products</span><br><span class="line">GET     /products/:ean                 controllers.Products.show(ean: Long)</span><br></pre></td></tr></table></figure>
<p>Products控制器，为了支持国际化，添加I18nSupport接口。注意每个Action都添加了<code>implicit request =&gt;</code></p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Singleton</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Products</span> <span class="title">@Inject</span>(<span class="params"></span>) (<span class="params">val messagesApi: <span class="type">MessagesApi</span></span>) <span class="keyword">extends</span> <span class="title">Controller</span> <span class="keyword">with</span> <span class="title">I18nSupport</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">products</span> </span>= <span class="type">Action</span> &#123; <span class="keyword">implicit</span> request =&gt;</span><br><span class="line">    <span class="keyword">val</span> products = <span class="type">Product</span>.findAll</span><br><span class="line">    <span class="type">Ok</span>(views.html.products.list(products))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">def</span> <span class="title">show</span></span>(ean: <span class="type">Long</span>) = <span class="type">Action</span> &#123; <span class="keyword">implicit</span> request =&gt;</span><br><span class="line">    <span class="type">Product</span>.findByEan(ean).map &#123; product =&gt;</span><br><span class="line">      <span class="type">Ok</span>(views.html.products.details(product))</span><br><span class="line">    &#125;.getOrElse(<span class="type">NotFound</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>views/products/list.scala.html</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@(productList: List[Product])(implicit lang: Messages)</span><br><span class="line"></span><br><span class="line">@products.main(Messages("application.name")) &#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">dl</span> <span class="attr">class</span>=<span class="string">"products"</span>&gt;</span></span><br><span class="line">    @for(product <span class="tag">&lt;<span class="name">-</span> <span class="attr">productList</span>) &#123;</span></span><br><span class="line">        &lt;dt&gt;&lt;a href="@controllers.routes.Products.show(product.ean)"&gt;@product.ean&lt;/a&gt;&lt;/dt&gt;</span><br><span class="line">        <span class="tag">&lt;<span class="name">dt</span>&gt;</span>@product.name<span class="tag">&lt;/<span class="name">dt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dd</span>&gt;</span>@product.description<span class="tag">&lt;/<span class="name">dd</span>&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">dl</span>&gt;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意第一行的参数<code>productList</code>不能命名为：<code>products</code>，否则第二行的<a href="mailto:`@products.main" target="_blank" rel="noopener">`@products.main</a><code>会报错，
它会认为</code>products<code>来自于第一行的参数，但这个参数并没有</code>main<code>方法（List没有main方法）。而实际上</code>@products.main<code>代表的是要调用</code>@views.html.products.main<code>对应的</code>views/products/main.scala.html<code>页面。  
注意：</code>productList<code>参数名称不需要和</code>Products<code>控制器的</code>products<code>方法的</code>products`变量相同，只要类型相同即可，所以可以是任意的名称。</p>
</blockquote>
<p>这里还有一个隐式的Messages，用来做国际化的支持。</p>
<p>反向路由：在product的en上超链接：”@controllers.routes.Products.show(product.ean)”，也可以省略掉controllers：”@routes.Products.show(product.ean)”。<br>在从路由配置到控制器时，Play会帮我们创建一个控制器到路由的反向路由配置。比如这里页面要访问”Products.show”方法。  </p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111154733495" alt="reverse route"></p>
<p>本节知识点：</p>
<ol>
<li>国际化的支持，以及implicit隐式参数的使用</li>
<li>参数名称不能和嵌套模板的子目录名称一样（比如参数productList，子目录是products，两者不能相同）</li>
<li>在页面中访问控制器方法，使用反向路由</li>
</ol>
<h2 id="implicit">implicit</h2><p>正常的Action调用</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//normal invoke, must pass Cart Object</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">catalog10</span></span>() = <span class="type">Action</span> &#123; request =&gt;</span><br><span class="line">  <span class="keyword">val</span> products = <span class="type">ProductDAO</span>.list</span><br><span class="line">  <span class="type">Ok</span>(views.html.shop.catalog10(products, cart(request)))</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cart</span></span>(request: <span class="type">RequestHeader</span>) = &#123;</span><br><span class="line">  <span class="type">Cart</span>.demoCart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的页面：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@(products: Seq[Product3], cart: Cart)</span><br><span class="line"></span><br><span class="line">@shop.cart10("")(cart) &#123;</span><br><span class="line">    <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Catalog<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">    @views.html.shop.productList(products)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用implicit，不需要传递Cat对象，不过request需要使用implicit，同时还要提供一个能够生成Cart对象的方法或者trait接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">//implicit invoke, no need to pass Cart</span><br><span class="line">def catalog11() = Action &#123; implicit request =&gt;</span><br><span class="line">  val products = ProductDAO.list</span><br><span class="line">  //too many arguments for method apply: (content: C)(implicit writeable: play.api.http.Writeable[C])play.api.mvc.Result in class Status</span><br><span class="line">  //Ok(views.html.shop.catalog11(products), cart(request))</span><br><span class="line"></span><br><span class="line">  //如果没有定义implicit的方法,是不会直接使用上面的cart方法的</span><br><span class="line">  //could not find implicit value for parameter cart: models.Cart</span><br><span class="line">  Ok(views.html.shop.catalog11(products))</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//方法名称任意,只要定义成implicit即可</span><br><span class="line">//注意:如果去掉返回类型: models.Cart,也会报错说找不到models.Cart,所以要显示声明返回类型</span><br><span class="line">implicit def cartImplicit(implicit request: RequestHeader): models.Cart = &#123;</span><br><span class="line">  Cart.demoCart()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>对应的页面：可以看到参数中cart变成implicit，调用时，不需要传递cart了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@(products: Seq[Product3])(implicit cart: Cart)</span><br><span class="line"></span><br><span class="line">@shop.cart11(&quot;&quot;) &#123;</span><br><span class="line">    &lt;h2&gt;Catalog&lt;/h2&gt;</span><br><span class="line">    @views.html.shop.productList(products)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果没有implicit方法没有显示指定类型，也会报错：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111170901722" alt="implicit 1"></p>
<p>We’ve moved the Cart parameter to a second parameter list and made it implicit,<br>so we can apply this template and omit the second parameter list if an implicit Cart is available on the calling side. </p>
<p>Now we’ve declared the cart method as implicit. In addition, we’ve declared the RequestHeader parameter of<br>both our action and the cart method as implicit. If we now call the views.html.shop.catalog template and<br>omit the Cart parameter, the Scala compiler will look for an implicit Cart in scope. It’ll find the cart method,<br>which requires a RequestHeader parameter that’s also declared as implicit, but that’s also available.<br>We can make our newly created cart method reusable, by moving it into a trait. Then We can<br>now mix this trait into every controller where we need access to our implicit Cart.</p>
<p>我们定义了Action方法的RequestHeader（implicit request）以及cart方法（implicit def cartImplicit）都是implicit。<br>那么调用catalog模板（views.html.shop.catalog11(products)）时就可以省略Cart参数，Scala的编译器会在范围内寻找隐式的Cart对象。<br>它会找到cart方法（implicit def cartImplicit）。为了让隐式的Cart方法可重用，可以定义在一个接口中，这样其他控制器都可以使用这个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">trait WithCart &#123;</span><br><span class="line">  implicit def cart(implicit request: RequestHeader) = &#123;</span><br><span class="line">    // Get cart from session</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161111170829019" alt="implicit cart"></p>
<p>虽然使用implicit有诸多好处，但是在需要添加其他implicit参数时，还要在页面中依次添加对应的(implicit)声明。解决办法是用一个对象来表示所有的隐式参数<br>然后在页面中使用这个隐式的对象即可，当需要添加隐式参数时，往对象中添加即可，页面中因为引用的是对象，所以自动继承了这个对象的所有隐式参数。</p>
<p>It’s often necessary to pass multiple values from your controller into your main template. Even with implicit parameters,<br>it would be a hassle to have to add another one each time, because you’d still have to add the implicit parameter to all<br>of the template definitions. One straightforward solution is to create a single class that contains all the objects you<br>need in your template, and pass an instance of that. If you want to add a value to it, you only need to adapt the template<br>where you use it, and the method that constructs it.  </p>
<p>It’s common to pass the RequestHeader or Request to templates, as we’ll see in section 6.7.2.<br>Play provides a WrappedRequest class, which wraps a Request and implements the interface itself as well,<br>so it’s usable as if it were a regular Request. But by extending WrappedRequest, you can add other fields:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">case class UserDataRequest[A](val user: User, val cart: Cart, request: Request[A]) extends WrappedRequest(request)</span><br></pre></td></tr></table></figure>
<p>If you pass an instance of this UserDataRequest to your template, you have a refer- ence to the Request, User, and Cart.</p>
<h1 id="Spark集成">Spark集成</h1><p>Play和Spark使用的jackson依赖包有冲突，如果没有显示指定jackson，报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$$anon$1: Execution exception[[RuntimeException: </span><br><span class="line">java.lang.VerifyError: class com.fasterxml.jackson.module.scala.ser.ScalaIteratorSerializer overrides final method withResolved.</span><br><span class="line">(Lcom/fasterxml/jackson/databind/BeanProperty;Lcom/fasterxml/jackson/databind/jsontype/TypeSerializer;</span><br><span class="line">  Lcom/fasterxml/jackson/databind/JsonSerializer;)Lcom/fasterxml/jackson/databind/ser/std/AsArraySerializerBase;]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:280)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:206)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at Global$.onError(Global.scala:11)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:98)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br></pre></td></tr></table></figure>
<p><a href="https://groups.google.com/forum/#!topic/play-framework/LIf_Ughidcc" target="_blank" rel="noopener">https://groups.google.com/forum/#!topic/play-framework/LIf_Ughidcc</a><br><a href="https://github.com/FasterXML/jackson-module-scala/issues/214">https://github.com/FasterXML/jackson-module-scala/issues/214</a><br><a href="http://stackoverflow.com/questions/33815396/spark-com-fasterxml-jackson-module-error" target="_blank" rel="noopener">http://stackoverflow.com/questions/33815396/spark-com-fasterxml-jackson-module-error</a>  </p>
<p>没有指定jackson时，jackson-module-scala和jackson-databind的不一致：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161118100439795" alt="play-spark-jackson1"></p>
<p>在build.sbt手动添加<code>jackson-module-scala</code>的依赖，版本和Play的一致。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">libraryDependencies += &quot;com.fasterxml.jackson.module&quot; % &quot;jackson-module-scala_2.11&quot; % &quot;2.7.6&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161118100453598" alt="play-spark-jackson2"></p>
<p>如果Actor版本不对，执行Spark时可能报错：比如引入了libraryDependencies += “com.github.dnvriend” %% “akka-persistence-jdbc” % “2.6.8”<br>是的Actor版本从2.4.10升级到2.4.12</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$$anon$1: Execution exception[[RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:293)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:220)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at Global$.onError(Global.scala:11)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br></pre></td></tr></table></figure>
<h2 id="play-spark-module">play-spark-module</h2><p><a href="https://github.com/JoaoVasques/play-spark-module">https://github.com/JoaoVasques/play-spark-module</a>  </p>
<p>修改SparkController的timeout时间为30s，访问：<a href="http://localhost:9000/spark/count" target="_blank" rel="noopener">http://localhost:9000/spark/count</a>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[warn] o.a.h.u.NativeCodeLoader - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">[info] p.m.i.j.p.s.w.SparkJobWorker - Starting job 1561847669 future</span><br><span class="line">3.216</span><br><span class="line">[info] p.m.i.j.p.s.w.SparkJobWorker - Job is done. Shutting down worker</span><br></pre></td></tr></table></figure>
<h2 id="Spark_Launcher">Spark Launcher</h2><p>Package org.apache.spark.launcher：Library for launching Spark applications.<br>This library allows applications to launch Spark programmatically. There’s only one entry point to the library - the SparkLauncher class.</p>
<p>The SparkLauncher.startApplication( org.apache.spark.launcher.SparkAppHandle.Listener…) can be used to start Spark and provide a handle to monitor and control the running application:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.spark.launcher.SparkAppHandle;</span><br><span class="line">import org.apache.spark.launcher.SparkLauncher;</span><br><span class="line"></span><br><span class="line">public class MyLauncher &#123;</span><br><span class="line"> public static void main(String[] args) throws Exception &#123;</span><br><span class="line">   SparkAppHandle handle = new SparkLauncher()</span><br><span class="line">     .setAppResource(&quot;/my/app.jar&quot;)</span><br><span class="line">     .setMainClass(&quot;my.spark.app.Main&quot;)</span><br><span class="line">     .setMaster(&quot;local&quot;)</span><br><span class="line">     .setConf(SparkLauncher.DRIVER_MEMORY, &quot;2g&quot;)</span><br><span class="line">     .startApplication();</span><br><span class="line">   // Use handle API to monitor / control application.</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>It’s also possible to launch a raw child process, using the SparkLauncher.launch() method:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.spark.launcher.SparkLauncher;</span><br><span class="line"></span><br><span class="line">public class MyLauncher &#123;</span><br><span class="line"> public static void main(String[] args) throws Exception &#123;</span><br><span class="line">   Process spark = new SparkLauncher()</span><br><span class="line">     .setAppResource(&quot;/my/app.jar&quot;)</span><br><span class="line">     .setMainClass(&quot;my.spark.app.Main&quot;)</span><br><span class="line">     .setMaster(&quot;local&quot;)</span><br><span class="line">     .setConf(SparkLauncher.DRIVER_MEMORY, &quot;2g&quot;)</span><br><span class="line">     .launch();</span><br><span class="line">   spark.waitFor();</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>This method requires the calling code to manually manage the child process, including its output streams (to avoid possible deadlocks). It’s recommended that SparkLauncher.startApplication( org.apache.spark.launcher.SparkAppHandle.Listener…) be used instead.</p>
<h3 id="mesos">mesos</h3><p>代码中指定本地文件（不推荐用法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd /Users/zhengqh/Github/scala/simple-app</span><br><span class="line">mvn clean package</span><br><span class="line">~/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit --class &quot;SimpleApp&quot; --master local\[2\] \</span><br><span class="line">target/scala-2.10/simple-project_2.10-1.0.jar</span><br></pre></td></tr></table></figure>
<p>命令行指定file路径（也可以指定文件类型，比如本地或者hdfs，推荐用法）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit --class &quot;SimpleApp&quot; --master local\[2\] \</span><br><span class="line">--conf spark.app.logfile=&quot;file:///Users/zhengqh/Github/scala/simple-app/README.md&quot; \</span><br><span class="line">target/scala-2.10/simple-project_2.10-1.0.jar</span><br></pre></td></tr></table></figure>
<p>如果本地环境变量有HADOOP_CONF_DIR，需要注释掉，否则会使用hdfs，报错：  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.net.ConnectException: Call From zqhmac/10.57.2.31 to localhost:9000 </span><br><span class="line">failed on connection exception: java.net.ConnectException: Connection refused; For more details see: </span><br><span class="line">http://wiki.apache.org/hadoop/ConnectionRefused</span><br></pre></td></tr></table></figure>
<p>命令行也可以指定其他运行方式，比如mesos，所以不推荐在代码中写死setMaster，除非开发时设置为setMaster(“local[*]”)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit --class &quot;SimpleApp&quot; --master &quot;mesos://192.168.6.52:5050&quot; \</span><br><span class="line">--conf spark.app.logfile=&quot;file:///Users/zhengqh/Github/scala/simple-app/README.md&quot; \</span><br><span class="line">target/scala-2.10/simple-project_2.10-1.0.jar</span><br></pre></td></tr></table></figure>
<p>在本地运行时报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Failed to load native Mesos library from /Users/zhengqh/Library/Java/Extensions:/Library/Java/Extensions:</span><br><span class="line">/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.</span><br><span class="line">Exception in thread &quot;main&quot; java.lang.UnsatisfiedLinkError: no mesos in java.library.path</span><br></pre></td></tr></table></figure>
<p>所以需要在本地安装有mesos环境，Mac安装mesos可以参考<a href="https://mesosphere.com/blog/2014/07/07/installing-mesos-on-your-mac-with-homebrew/" target="_blank" rel="noopener">https://mesosphere.com/blog/2014/07/07/installing-mesos-on-your-mac-with-homebrew/</a>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">brew install mesos</span><br><span class="line">/usr/local/sbin/mesos-master --registry=in_memory --ip=127.0.0.1</span><br></pre></td></tr></table></figure>
<p>环境变量添加mesos:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># For Linux</span><br><span class="line">$ export MESOS_NATIVE_JAVA_LIBRARY=&apos;/usr/local/lib/libmesos.so&apos;</span><br><span class="line"># For OSX</span><br><span class="line">$ export MESOS_NATIVE_JAVA_LIBRARY=&apos;/usr/local/lib/libmesos.dylib&apos;</span><br></pre></td></tr></table></figure>
<p>本地安装好mesos,设置好mesos库，指定远程mesos：mesos://192.168.6.52:5050</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">**************************************************</span><br><span class="line">Scheduler driver bound to loopback interface! Cannot communicate with remote master(s). You might want to set &apos;LIBPROCESS_IP&apos; environment variable to use a routable IP address.</span><br><span class="line">**************************************************</span><br><span class="line">I1121 15:07:33.008949 778174464 sched.cpp:157] Version: 0.22.1</span><br><span class="line">I1121 15:07:33.016233 651489280 sched.cpp:254] New master detected at master@192.168.6.52:5050</span><br></pre></td></tr></table></figure>
<p>但是，执行到上面后就不动了，可能是本地的mesos和远程mesos版本不对：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit --class &quot;SimpleApp&quot; --master mesos://zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos \</span><br><span class="line">--conf spark.app.logfile=&quot;file:///Users/zhengqh/Github/scala/simple-app/README.md&quot; \</span><br><span class="line">target/scala-2.10/simple-project_2.10-1.0.jar</span><br><span class="line"></span><br><span class="line">I1121 15:34:42.195302 655667200 group.cpp:313] Group process (group(1)@127.0.0.1:61225) connected to ZooKeeper</span><br><span class="line">I1121 15:34:42.195796 655667200 group.cpp:790] Syncing group operations: queue size (joins, cancels, datas) = (0, 0, 0)</span><br><span class="line">I1121 15:34:42.196069 655667200 group.cpp:385] Trying to create path &apos;/mesos&apos; in ZooKeeper</span><br><span class="line">I1121 15:34:42.208238 662253568 detector.cpp:138] Detected a new leader: (id=&apos;62&apos;)</span><br><span class="line">I1121 15:34:42.208575 655667200 group.cpp:659] Trying to get &apos;/mesos/json.info_0000000062&apos; in ZooKeeper</span><br><span class="line">Failed to detect a master: Failed to parse data of unknown label &apos;json.info</span><br></pre></td></tr></table></figure>
<p>如果指定本地mesos（要先在本地启动mesos-local）：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">~/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit --class &quot;SimpleApp&quot; --master &quot;mesos://localhost:5050&quot; \</span><br><span class="line">--conf spark.app.logfile=&quot;file:///Users/zhengqh/Github/scala/simple-app/README.md&quot; \</span><br><span class="line">target/scala-2.10/simple-project_2.10-1.0.jar</span><br><span class="line"></span><br><span class="line">I1121 15:11:07.611460 515149824 sched.cpp:448] Framework registered with 20161121-150645-16777343-5050-14247-0000 出现Framework registered，实际上就说明连接本地mesos成功了</span><br><span class="line">16/11/21 15:11:07 INFO mesos.CoarseMesosSchedulerBackend: Registered as framework ID 20161121-150645-16777343-5050-14247-0000</span><br><span class="line">16/11/21 15:11:08 INFO mesos.CoarseMesosSchedulerBackend: SchedulerBackend is ready for scheduling beginning after reached minRegisteredResourcesRatio: 0.0</span><br><span class="line">16/11/21 15:11:08 INFO mesos.CoarseMesosSchedulerBackend: Mesos task 0 is now TASK_RUNNING</span><br><span class="line">16/11/21 15:11:12 INFO spark.SparkContext: Starting job: count at SimpleApp.scala:13</span><br><span class="line">Lines with a: 1, Lines with b: 0</span><br></pre></td></tr></table></figure>
<p>或者将jar包上传到具有mesos环境的客户端节点，因为远程spark-mesos已经集成好了，所以可以不写–master</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/spark/bin/spark-submit --class &quot;SimpleApp&quot; --master &quot;mesos://192.168.6.52:5050&quot; \</span><br><span class="line">--conf spark.app.logfile=&quot;/user/qihuang.zheng/hello.txt&quot; \</span><br><span class="line">simple-project_2.10-1.0.jar</span><br></pre></td></tr></table></figure>
<h3 id="问题">问题</h3><p>远程运行任务，并指定proxy-user</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">sudo -u admin /usr/install/spark/bin/spark-submit \</span><br><span class="line">--master mesos://zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos \</span><br><span class="line">--class cn.fraudmetrix.pontus.demo.SimpleApp \</span><br><span class="line">--proxy-user qihuang.zheng \</span><br><span class="line">--conf spark.app.logfile=&quot;/user/qihuang.zheng/hello.txt&quot; \</span><br><span class="line">/usr/install/pontus/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br><span class="line"></span><br><span class="line">sudo -u admin /usr/install/spark/bin/spark-submit \</span><br><span class="line">--master &quot;mesos://zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos&quot; \</span><br><span class="line">--proxy-user qihuang.zheng \</span><br><span class="line">--class cn.fraudmetrix.pontus.cassandra.PontusCassandra2HDFSJobHandler \</span><br><span class="line">--conf spark.app.logfile=&quot;/usr/install/spark/README.md&quot; \</span><br><span class="line">--conf spark.pontus.destTable=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.tableId=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.destType=&quot;HDFS&quot; \</span><br><span class="line">--conf spark.cores.max=&quot;10&quot; \</span><br><span class="line">--conf spark.pontus.execution.id=&quot;3&quot; \</span><br><span class="line">--conf spark.pontus.destUsername=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.creator=&quot;qihuang.zheng&quot; \</span><br><span class="line">--conf spark.pontus.sourceUri=&quot;192.168.6.53/keyspace1&quot; \</span><br><span class="line">--conf spark.pontus.sourcePassword=&quot;&quot; \</span><br><span class="line">--conf spark.mesos.role=&quot;test&quot; \</span><br><span class="line">--conf spark.pontus.sourceTable=&quot;standard1&quot; \</span><br><span class="line">--conf spark.pontus.sourceType=&quot;Cassandra&quot; \</span><br><span class="line">--conf spark.pontus.readMode=&quot;1&quot; \</span><br><span class="line">--conf spark.pontus.tableTs=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.destUri=&quot;/user/tongdun/pontus/standard1&quot; \</span><br><span class="line">--conf spark.executor.memory=&quot;4g&quot; \</span><br><span class="line">--conf spark.pontus.name=&quot;cassandra-hdfs&quot; \</span><br><span class="line">--conf spark.pontus.destPassword=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.id=&quot;2&quot; \</span><br><span class="line">--conf spark.pontus.writeMode=&quot;1&quot; \</span><br><span class="line">--conf spark.pontus.sourceUsername=&quot;&quot; \</span><br><span class="line">/usr/install/pontus/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br></pre></td></tr></table></figure>
<p>mesos kill framework, but won’t kill spark driver</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -XPOST http://192.168.6.52:5050/master/teardown -d &apos;frameworkId=475189a7-dcde-4859-9af8-6fc2e63be94e-0556&apos;</span><br></pre></td></tr></table></figure>
<p>手动设置spark.app.id无效：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/install/spark/bin/spark-submit \</span><br><span class="line">--master mesos://zk://192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181/mesos \</span><br><span class="line">--class cn.fraudmetrix.pontus.demo.SimpleApp \</span><br><span class="line">--conf &quot;spark.app.id=SimpleApp&quot; \</span><br><span class="line">--conf spark.app.logfile=&quot;/user/qihuang.zheng/hello.txt&quot; \</span><br><span class="line">/usr/install/pontus/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br></pre></td></tr></table></figure>
<p>序列化不适配？？ spark_2.10和2.11的版本问题？？</p>
<p>play_2.5.9不支持scal_2.10: <a href="https://www.playframework.com/documentation/2.5.x/Migration25" target="_blank" rel="noopener">https://www.playframework.com/documentation/2.5.x/Migration25</a><br>Play 2.3 and 2.4 supported both Scala 2.10 and 2.11. Play 2.5 has dropped support for Scala 2.10 and now only supports Scala 2.11.  </p>
<p>Jira: <a href="https://issues.apache.org/jira/browse/SPARK-13956" target="_blank" rel="noopener">https://issues.apache.org/jira/browse/SPARK-13956</a><br>说的是driver版本和executor版本不一致导致的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">I1209 20:58:27.190430  3039 sched.cpp:703] Framework registered with 475189a7-dcde-4859-9af8-6fc2e63be94e-0423</span><br><span class="line">[info] p.m.i.j.p.s.w.SparkJobWorker - Starting job -1651747420 future</span><br><span class="line">[Stage 0:&gt;                                                          (0 + 0) / 2][error] o.a.s.n.s.TransportRequestHandler - Error while invoking RpcHandler#receive() on RPC id 8897300371223004861</span><br><span class="line">java.io.InvalidClassException: org.apache.spark.rpc.netty.RequestMessage; local class incompatible: stream classdesc serialVersionUID = -2221986757032131007, local class serialVersionUID = -5447855329526097695</span><br><span class="line">  at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:616)</span><br><span class="line">  at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1623)</span><br><span class="line">  at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)</span><br><span class="line">  at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)</span><br><span class="line">  at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)</span><br><span class="line">  at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)</span><br><span class="line">  at org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:76)</span><br><span class="line">  at org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:109)</span><br><span class="line">  at org.apache.spark.rpc.netty.NettyRpcEnv$$anonfun$deserialize$1$$anonfun$apply$1.apply(NettyRpcEnv.scala:258)</span><br><span class="line">  at scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)</span><br><span class="line">[error] o.a.s.n.s.TransportRequestHandler - Error while invoking RpcHandler#receive() on RPC id 9207561725902043069</span><br><span class="line">java.io.InvalidClassException: org.apache.spark.rpc.netty.RequestMessage; local class incompatible: stream classdesc serialVersionUID = -2221986757032131007, local class serialVersionUID = -5447855329526097695</span><br><span class="line">  at java.io.ObjectStreamClass.initNonProxy(ObjectStreamClass.java:616)</span><br><span class="line">  at java.io.ObjectInputStream.readNonProxyDesc(ObjectInputStream.java:1623)</span><br><span class="line">  at java.io.ObjectInputStream.readClassDesc(ObjectInputStream.java:1518)</span><br><span class="line">  at java.io.ObjectInputStream.readOrdinaryObject(ObjectInputStream.java:1774)</span><br><span class="line">  at java.io.ObjectInputStream.readObject0(ObjectInputStream.java:1351)</span><br><span class="line">  at java.io.ObjectInputStream.readObject(ObjectInputStream.java:371)</span><br><span class="line">  at org.apache.spark.serializer.JavaDeserializationStream.readObject(JavaSerializer.scala:76)</span><br><span class="line">  at org.apache.spark.serializer.JavaSerializerInstance.deserialize(JavaSerializer.scala:109)</span><br><span class="line">  at org.apache.spark.rpc.netty.NettyRpcEnv$$anonfun$deserialize$1$$anonfun$apply$1.apply(NettyRpcEnv.scala:258)</span><br><span class="line">  at scala.util.DynamicVariable.withValue(DynamicVariable.scala:58)</span><br><span class="line">[warn] o.a.s.s.TaskSchedulerImpl - Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources</span><br><span class="line">[error] application -</span><br><span class="line"></span><br><span class="line">! @72b33a0kb - Internal server error, for (GET) [/spark] -&gt;</span><br><span class="line"></span><br><span class="line">play.api.UnexpectedException: Unexpected exception[TimeoutException: Futures timed out after [30 seconds]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:276)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:206)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at util.Global$.onError(Global.scala:22)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:98)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br><span class="line">Caused by: java.util.concurrent.TimeoutException: Futures timed out after [30 seconds]</span><br><span class="line">  at scala.concurrent.impl.Promise$DefaultPromise.ready(Promise.scala:219)</span><br><span class="line">  at scala.concurrent.impl.Promise$DefaultPromise.result(Promise.scala:223)</span><br><span class="line">  at scala.concurrent.Await$$anonfun$result$1.apply(package.scala:190)</span><br><span class="line">  at akka.dispatch.MonitorableThreadFactory$AkkaForkJoinWorkerThread$$anon$3.block(ThreadPoolBuilder.scala:167)</span><br><span class="line">  at scala.concurrent.forkjoin.ForkJoinPool.managedBlock(ForkJoinPool.java:3640)</span><br><span class="line">  at akka.dispatch.MonitorableThreadFactory$AkkaForkJoinWorkerThread.blockOn(ThreadPoolBuilder.scala:165)</span><br><span class="line">  at akka.dispatch.BatchingExecutor$BlockableBatch.blockOn(BatchingExecutor.scala:106)</span><br><span class="line">  at scala.concurrent.Await$.result(package.scala:190)</span><br><span class="line">  at controllers.SparkController$$anonfun$sparkJob$1.apply(SparkController.scala:56)</span><br><span class="line">  at controllers.SparkController$$anonfun$sparkJob$1.apply(SparkController.scala:42)</span><br><span class="line">[warn] o.a.s.s.TaskSchedulerImpl - Initial job has not accepted any resources; check your cluster UI to ensure that workers are registered and have sufficient resources</span><br></pre></td></tr></table></figure>
<p>把spark-core打包方式改为provided是不行的。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.NoClassDefFoundError: org/apache/spark/Logging</span><br><span class="line">  at java.lang.ClassLoader.defineClass1(Native Method)</span><br><span class="line">  at java.lang.ClassLoader.defineClass(ClassLoader.java:760)</span><br><span class="line">  at java.security.SecureClassLoader.defineClass(SecureClassLoader.java:142)</span><br><span class="line">  at java.net.URLClassLoader.defineClass(URLClassLoader.java:467)</span><br><span class="line">  at java.net.URLClassLoader.access$100(URLClassLoader.java:73)</span><br><span class="line">  at java.net.URLClassLoader$1.run(URLClassLoader.java:368)</span><br><span class="line">  at java.net.URLClassLoader$1.run(URLClassLoader.java:362)</span><br><span class="line">  at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">  at java.net.URLClassLoader.findClass(URLClassLoader.java:361)</span><br><span class="line">  at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">  at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)</span><br><span class="line">  at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">  at java.lang.Class.getDeclaredConstructors0(Native Method)</span><br><span class="line">  at java.lang.Class.privateGetDeclaredConstructors(Class.java:2671)</span><br><span class="line">  at java.lang.Class.getDeclaredConstructors(Class.java:2020)</span><br><span class="line">  at com.google.inject.spi.InjectionPoint.forConstructorOf(InjectionPoint.java:245)</span><br><span class="line">  at com.google.inject.internal.ConstructorBindingImpl.create(ConstructorBindingImpl.java:99)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.createUninitializedBinding(InjectorImpl.java:658)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.createJustInTimeBinding(InjectorImpl.java:882)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.createJustInTimeBindingRecursive(InjectorImpl.java:805)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getJustInTimeBinding(InjectorImpl.java:282)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getBindingOrThrow(InjectorImpl.java:214)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getProviderOrThrow(InjectorImpl.java:1006)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getProvider(InjectorImpl.java:1038)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getProvider(InjectorImpl.java:1001)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.getInstance(InjectorImpl.java:1051)</span><br><span class="line">  at play.api.inject.guice.GuiceInjector.instanceOf(GuiceInjectorBuilder.scala:405)</span><br><span class="line">  at play.api.inject.RoutesProvider$$anonfun$2.apply(BuiltinModule.scala:82)</span><br><span class="line">  at play.api.inject.RoutesProvider$$anonfun$2.apply(BuiltinModule.scala:82)</span><br><span class="line">  at scala.Option.fold(Option.scala:158)</span><br><span class="line">  at play.api.inject.RoutesProvider.get$lzycompute(BuiltinModule.scala:82)</span><br><span class="line">  at play.api.inject.RoutesProvider.get(BuiltinModule.scala:78)</span><br><span class="line">  at play.api.inject.RoutesProvider.get(BuiltinModule.scala:77)</span><br><span class="line">  at com.google.inject.internal.ProviderInternalFactory.provision(ProviderInternalFactory.java:81)</span><br><span class="line">  at com.google.inject.internal.BoundProviderFactory.provision(BoundProviderFactory.java:72)</span><br><span class="line">  at com.google.inject.internal.ProviderInternalFactory.circularGet(ProviderInternalFactory.java:61)</span><br><span class="line">  at com.google.inject.internal.BoundProviderFactory.get(BoundProviderFactory.java:62)</span><br><span class="line">  at com.google.inject.internal.SingleParameterInjector.inject(SingleParameterInjector.java:38)</span><br><span class="line">  at com.google.inject.internal.SingleParameterInjector.getAll(SingleParameterInjector.java:62)</span><br><span class="line">  at com.google.inject.internal.ConstructorInjector.provision(ConstructorInjector.java:104)</span><br><span class="line">  at com.google.inject.internal.ConstructorInjector.construct(ConstructorInjector.java:85)</span><br><span class="line">  at com.google.inject.internal.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:267)</span><br><span class="line">  at com.google.inject.internal.FactoryProxy.get(FactoryProxy.java:56)</span><br><span class="line">  at com.google.inject.internal.SingleParameterInjector.inject(SingleParameterInjector.java:38)</span><br><span class="line">  at com.google.inject.internal.SingleParameterInjector.getAll(SingleParameterInjector.java:62)</span><br><span class="line">  at com.google.inject.internal.ConstructorInjector.provision(ConstructorInjector.java:104)</span><br><span class="line">  at com.google.inject.internal.ConstructorInjector.construct(ConstructorInjector.java:85)</span><br><span class="line">  at com.google.inject.internal.ConstructorBindingImpl$Factory.get(ConstructorBindingImpl.java:267)</span><br><span class="line">  at com.google.inject.internal.ProviderToInternalFactoryAdapter$1.call(ProviderToInternalFactoryAdapter.java:46)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.callInContext(InjectorImpl.java:1103)</span><br><span class="line">  at com.google.inject.internal.ProviderToInternalFactoryAdapter.get(ProviderToInternalFactoryAdapter.java:40)</span><br><span class="line">  at com.google.inject.internal.SingletonScope$1.get(SingletonScope.java:145)</span><br><span class="line">  at com.google.inject.internal.InternalFactoryToProviderAdapter.get(InternalFactoryToProviderAdapter.java:41)</span><br><span class="line">  at com.google.inject.internal.FactoryProxy.get(FactoryProxy.java:56)</span><br><span class="line">  at com.google.inject.internal.InternalInjectorCreator$1.call(InternalInjectorCreator.java:205)</span><br><span class="line">  at com.google.inject.internal.InternalInjectorCreator$1.call(InternalInjectorCreator.java:199)</span><br><span class="line">  at com.google.inject.internal.InjectorImpl.callInContext(InjectorImpl.java:1092)</span><br><span class="line">  at com.google.inject.internal.InternalInjectorCreator.loadEagerSingletons(InternalInjectorCreator.java:199)</span><br><span class="line">  at com.google.inject.internal.InternalInjectorCreator.injectDynamically(InternalInjectorCreator.java:180)</span><br><span class="line">  at com.google.inject.internal.InternalInjectorCreator.build(InternalInjectorCreator.java:110)</span><br><span class="line">  at com.google.inject.Guice.createInjector(Guice.java:96)</span><br><span class="line">  at com.google.inject.Guice.createInjector(Guice.java:84)</span><br><span class="line">  at play.api.inject.guice.GuiceBuilder.injector(GuiceInjectorBuilder.scala:181)</span><br><span class="line">  at play.api.inject.guice.GuiceApplicationBuilder.build(GuiceApplicationBuilder.scala:123)</span><br><span class="line">  at play.api.inject.guice.GuiceApplicationLoader.load(GuiceApplicationLoader.scala:21)</span><br><span class="line">  at play.core.server.ProdServerStart$.start(ProdServerStart.scala:47)</span><br><span class="line">  at play.core.server.ProdServerStart$.main(ProdServerStart.scala:22)</span><br><span class="line">  at play.core.server.ProdServerStart.main(ProdServerStart.scala)</span><br><span class="line">Caused by: java.lang.ClassNotFoundException: org.apache.spark.Logging</span><br><span class="line">  at java.net.URLClassLoader.findClass(URLClassLoader.java:381)</span><br><span class="line">  at java.lang.ClassLoader.loadClass(ClassLoader.java:424)</span><br><span class="line">  at sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:331)</span><br><span class="line">  at java.lang.ClassLoader.loadClass(ClassLoader.java:357)</span><br><span class="line">  ... 68 more</span><br></pre></td></tr></table></figure>
<p>在pontus-web中直接运行Spark作业</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">! @72ck129fb - Internal server error, for (GET) [/preview/HDFS/activity] -&gt;</span><br><span class="line"></span><br><span class="line">play.api.UnexpectedException: Unexpected exception[RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:289)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:220)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at util.Global$.onError(Global.scala:20)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br><span class="line">Caused by: java.lang.RuntimeException: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;</span><br><span class="line">  at play.api.mvc.ActionBuilder$$anon$2.apply(Action.scala:463)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2$$anonfun$apply$5$$anonfun$apply$6.apply(Action.scala:112)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2$$anonfun$apply$5$$anonfun$apply$6.apply(Action.scala:112)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:21)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2$$anonfun$apply$5.apply(Action.scala:111)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2$$anonfun$apply$5.apply(Action.scala:110)</span><br><span class="line">  at scala.Option.map(Option.scala:146)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2.apply(Action.scala:110)</span><br><span class="line">  at play.api.mvc.Action$$anonfun$apply$2.apply(Action.scala:103)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$flatMap$1.apply(Future.scala:251)</span><br><span class="line">Caused by: java.lang.NoSuchMethodError: akka.actor.LocalActorRefProvider.log()Lakka/event/LoggingAdapter;</span><br><span class="line">  at akka.remote.RemoteActorRefProvider.&lt;init&gt;(RemoteActorRefProvider.scala:128)</span><br><span class="line">  at sun.reflect.NativeConstructorAccessorImpl.newInstance0(Native Method)</span><br><span class="line">  at sun.reflect.NativeConstructorAccessorImpl.newInstance(NativeConstructorAccessorImpl.java:62)</span><br><span class="line">  at sun.reflect.DelegatingConstructorAccessorImpl.newInstance(DelegatingConstructorAccessorImpl.java:45)</span><br><span class="line">  at java.lang.reflect.Constructor.newInstance(Constructor.java:422)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$$anonfun$createInstanceFor$2.apply(ReflectiveDynamicAccess.scala:32)</span><br><span class="line">  at scala.util.Try$.apply(Try.scala:192)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess.createInstanceFor(ReflectiveDynamicAccess.scala:27)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$$anonfun$createInstanceFor$3.apply(ReflectiveDynamicAccess.scala:38)</span><br><span class="line">  at akka.actor.ReflectiveDynamicAccess$$anonfun$createInstanceFor$3.apply(ReflectiveDynamicAccess.scala:38)</span><br></pre></td></tr></table></figure>
<p><a href="http://stackoverflow.com/questions/40883978/migration-to-play-2-5-leads-to-this-error-nosuchmethoderror-akka-actor-locala" target="_blank" rel="noopener">http://stackoverflow.com/questions/40883978/migration-to-play-2-5-leads-to-this-error-nosuchmethoderror-akka-actor-locala</a>  </p>
<p>监听器</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ssc.sparkContext.addSparkListener(new SparkListener()&#123;</span><br><span class="line">  override def onJobEnd(jobEnd: SparkListenerJobEnd): Unit = &#123;&#125;</span><br><span class="line">  override def onApplicationEnd(applicationEnd: SparkListenerApplicationEnd): Unit = &#123;</span><br><span class="line">    println(&quot;PontusKafka2HDFSJobHandler onApplicationEnd....&quot;)</span><br><span class="line">    PontusExecutionDao.updateStatus(conf)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>使用命令行测试，当关闭程序后，会打印onApplicationEnd事件。在mesos上使用kill driver直接杀死应用程序，也会调用监听器的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@712: Client environment:zookeeper.version=zookeeper C client 3.4.5</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@716: Client environment:host.name=dp0653</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@723: Client environment:os.name=Linux</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@724: Client environment:os.arch=3.10.97-1.el6.elrepo.x86_64</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@725: Client environment:os.version=#1 SMP Sat Feb 20 11:55:29 EST 2016</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@733: Client environment:user.name=qihuang.zheng</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@741: Client environment:user.home=/home/qihuang.zheng</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@log_env@753: Client environment:user.dir=/home/qihuang.zheng</span><br><span class="line">2016-12-13 11:34:45,534:41791(0x2b1d28803700):ZOO_INFO@zookeeper_init@786: Initiating client connection, host=192.168.6.55:2181,192.168.6.56:2181,192.168.6.57:2181 sessionTimeout=10000 watcher=0x2b1d000e1645 sessionId=0 sessionPasswd=&lt;null&gt; context=0x2b1d44000960 flags=0</span><br><span class="line">2016-12-13 11:34:45,535:41791(0x2b1d2950a700):ZOO_INFO@check_events@1703: initiated connection to server [192.168.6.57:2181]</span><br><span class="line">I1213 11:34:45.536334 42031 sched.cpp:222] Version: 0.28.2</span><br><span class="line">2016-12-13 11:34:45,555:41791(0x2b1d2950a700):ZOO_INFO@check_events@1750: session establishment complete on server [192.168.6.57:2181], sessionId=0x3589e76ef2f82e0, negotiated timeout=10000</span><br><span class="line">I1213 11:34:45.556421 42015 group.cpp:349] Group process (group(1)@192.168.6.53:45534) connected to ZooKeeper</span><br><span class="line">I1213 11:34:45.556823 42015 group.cpp:831] Syncing group operations: queue size (joins, cancels, datas) = (0, 0, 0)</span><br><span class="line">I1213 11:34:45.556903 42015 group.cpp:427] Trying to create path &apos;/mesos&apos; in ZooKeeper</span><br><span class="line">I1213 11:34:45.561131 42008 detector.cpp:152] Detected a new leader: (id=&apos;70&apos;)</span><br><span class="line">I1213 11:34:45.561971 42011 group.cpp:700] Trying to get &apos;/mesos/json.info_0000000070&apos; in ZooKeeper</span><br><span class="line">I1213 11:34:45.565317 42023 detector.cpp:479] A new leading master (UPID=master@192.168.6.52:5050) is detected</span><br><span class="line">I1213 11:34:45.565773 42026 sched.cpp:326] New master detected at master@192.168.6.52:5050</span><br><span class="line">I1213 11:34:45.567448 42026 sched.cpp:336] No credentials provided. Attempting to register without authentication</span><br><span class="line">I1213 11:34:45.574049 42026 sched.cpp:703] Framework registered with 475189a7-dcde-4859-9af8-6fc2e63be94e-0558</span><br><span class="line"></span><br><span class="line">^CPontusKafka2HDFSJobHandler onApplicationEnd....</span><br><span class="line">I1213 11:42:21.526136  4384 sched.cpp:1911] Asked to stop the driver</span><br><span class="line">I1213 11:42:21.526562 42020 sched.cpp:1143] Stopping framework &apos;475189a7-dcde-4859-9af8-6fc2e63be94e-0558&apos;</span><br></pre></td></tr></table></figure>
<h2 id="Spark_Cassandra">Spark Cassandra</h2><p>IDE中直接运行，spark依赖包不能为provided，否则找不到Spark的相关包，运行正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-core_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-sql_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-hive_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>使用maven-assembly-plugin插件打包运行，spark环境使用本地安装，scope=provide</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-core_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-sql_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.spark&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spark-hive_$&#123;scala.binary.version&#125;&lt;/artifactId&gt;</span><br><span class="line">    &lt;scope&gt;provided&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>打包，并用完整的依赖包执行spark-submit</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mvn clean package</span><br><span class="line"></span><br><span class="line">/Users/zhengqh/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit \</span><br><span class="line">--master &quot;local[2]&quot; \</span><br><span class="line">--class cn.fraudmetrix.pontus.demo.CassandraReadWrite \</span><br><span class="line">/Users/zhengqh/Github/vulcan/pontus-spark/target/pontus-spark-1.0.0-SNAPSHOT-jar-with-dependencies.jar</span><br></pre></td></tr></table></figure>
<p>报错guava版本不对，即使手动加上guava版本也报错：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">        &lt;dependency&gt;</span><br><span class="line">            &lt;groupId&gt;com.google.guava&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;guava&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;19.0&lt;/version&gt;</span><br><span class="line">        &lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">Exception in thread &quot;main&quot; java.lang.ExceptionInInitializerError</span><br><span class="line">  at com.datastax.spark.connector.cql.DefaultConnectionFactory$.clusterBuilder(CassandraConnectionFactory.scala:35)</span><br><span class="line">  at com.datastax.spark.connector.cql.DefaultConnectionFactory$.createCluster(CassandraConnectionFactory.scala:87)</span><br><span class="line">  at com.datastax.spark.connector.cql.CassandraConnector$.com$datastax$spark$connector$cql$CassandraConnector$$createSession(CassandraConnector.scala:153)</span><br><span class="line">  at com.datastax.spark.connector.cql.CassandraConnector$$anonfun$2.apply(CassandraConnector.scala:148)</span><br><span class="line">  at com.datastax.spark.connector.cql.CassandraConnector$$anonfun$2.apply(CassandraConnector.scala:148)</span><br><span class="line">  at com.datastax.spark.connector.cql.RefCountedCache.createNewValueAndKeys(RefCountedCache.scala:31)</span><br><span class="line">  at com.datastax.spark.connector.cql.RefCountedCache.acquire(RefCountedCache.scala:56)</span><br><span class="line">  at com.datastax.spark.connector.cql.CassandraConnector.openSession(CassandraConnector.scala:81)</span><br><span class="line">  at com.datastax.spark.connector.cql.CassandraConnector.withSessionDo(CassandraConnector.scala:109)</span><br><span class="line">  at cn.fraudmetrix.pontus.demo.CassandraReadWrite$.cn$fraudmetrix$pontus$demo$CassandraReadWrite$$executeCommand(CassandraReadWrite.scala:45)</span><br><span class="line">  at cn.fraudmetrix.pontus.demo.CassandraReadWrite$delayedInit$body.apply(CassandraReadWrite.scala:53)</span><br><span class="line">  at scala.Function0$class.apply$mcV$sp(Function0.scala:40)</span><br><span class="line">  at scala.runtime.AbstractFunction0.apply$mcV$sp(AbstractFunction0.scala:12)</span><br><span class="line">  at scala.App$$anonfun$main$1.apply(App.scala:71)</span><br><span class="line">  at scala.App$$anonfun$main$1.apply(App.scala:71)</span><br><span class="line">  at scala.collection.immutable.List.foreach(List.scala:318)</span><br><span class="line">  at scala.collection.generic.TraversableForwarder$class.foreach(TraversableForwarder.scala:32)</span><br><span class="line">  at scala.App$class.main(App.scala:71)</span><br><span class="line">  at cn.fraudmetrix.pontus.demo.CassandraReadWrite$.main(CassandraReadWrite.scala:36)</span><br><span class="line">  at cn.fraudmetrix.pontus.demo.CassandraReadWrite.main(CassandraReadWrite.scala)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">  at java.lang.reflect.Method.invoke(Method.java:497)</span><br><span class="line">  at org.apache.spark.deploy.SparkSubmit$.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:731)</span><br><span class="line">  at org.apache.spark.deploy.SparkSubmit$.doRunMain$1(SparkSubmit.scala:181)</span><br><span class="line">  at org.apache.spark.deploy.SparkSubmit$.submit(SparkSubmit.scala:206)</span><br><span class="line">  at org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:121)</span><br><span class="line">  at org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)</span><br><span class="line">Caused by: java.lang.IllegalStateException: Detected Guava issue #1635 which indicates that a version of Guava less than 16.01 is in use.  This introduces codec resolution issues and potentially other incompatibility issues in the driver.  Please upgrade to Guava 16.01 or later.</span><br><span class="line">  at com.datastax.driver.core.SanityChecks.checkGuava(SanityChecks.java:62)</span><br><span class="line">  at com.datastax.driver.core.SanityChecks.check(SanityChecks.java:36)</span><br><span class="line">  at com.datastax.driver.core.Cluster.&lt;clinit&gt;(Cluster.java:67)</span><br><span class="line">  ... 29 more</span><br></pre></td></tr></table></figure>
<p>参考：<a href="http://stackoverflow.com/questions/36877897/detected-guava-issue-1635-which-indicates-that-a-version-of-guava-less-than-16" target="_blank" rel="noopener">http://stackoverflow.com/questions/36877897/detected-guava-issue-1635-which-indicates-that-a-version-of-guava-less-than-16</a><br>添加maven-shade-plugin插件，重新打包，除了其他包，还会生成fat包，并用fat包运行，最后正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">ll target</span><br><span class="line">-rw-r--r--  1 zhengqh  staff    14M 11 24 19:17 pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br><span class="line">-rw-r--r--  1 zhengqh  staff    19M 11 24 19:15 pontus-spark-1.0.0-SNAPSHOT-jar-with-dependencies.jar</span><br><span class="line">-rw-r--r--  1 zhengqh  staff    14K 11 24 19:15 pontus-spark-1.0.0-SNAPSHOT-sources.jar</span><br><span class="line">-rw-r--r--  1 zhengqh  staff    94K 11 24 19:15 pontus-spark-1.0.0-SNAPSHOT.jar</span><br><span class="line"></span><br><span class="line">/Users/zhengqh/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit \</span><br><span class="line">--master &quot;local[2]&quot; \</span><br><span class="line">--class cn.fraudmetrix.pontus.demo.CassandraReadWrite \</span><br><span class="line">/Users/zhengqh/Github/vulcan/pontus-spark/target/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br></pre></td></tr></table></figure>
<p>测试读取Cassandra写入到HDFS是否正确（需要启动本地dfs和Cassandra）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/Users/zhengqh/Soft/spark-1.6.2-bin-hadoop2.6/bin/spark-submit \</span><br><span class="line">--master &quot;local[2]&quot; \</span><br><span class="line">--class cn.fraudmetrix.pontus.cassandra.PontusCassandra2HDFSJobHandler \</span><br><span class="line">--conf spark.pontus.destTable=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.tableId=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.destType=&quot;HDFS&quot; \</span><br><span class="line">--conf spark.pontus.destUsername=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.creator=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.sourceUri=&quot;localhost/demo&quot; \</span><br><span class="line">--conf spark.pontus.sourcePassword=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.sourceTable=&quot;sales&quot; \</span><br><span class="line">--conf spark.pontus.sourceType=&quot;Cassandra&quot; \</span><br><span class="line">--conf spark.pontus.readMode=&quot;1&quot; \</span><br><span class="line">--conf spark.pontus.tableTs=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.destUri=&quot;hdfs://localhost:9000/test&quot; \</span><br><span class="line">--conf spark.pontus.name=&quot;cassandra-hdfs&quot; \</span><br><span class="line">--conf spark.pontus.destPassword=&quot;&quot; \</span><br><span class="line">--conf spark.pontus.id=&quot;1&quot; \</span><br><span class="line">--conf spark.pontus.writeMode=&quot;1&quot; \</span><br><span class="line">--conf spark.pontus.sourceUsername=&quot;&quot; \</span><br><span class="line">/Users/zhengqh/Github/vulcan/pontus-spark/target/pontus-spark-1.0.0-SNAPSHOT-fat.jar</span><br><span class="line"></span><br><span class="line">16/11/24 19:19:16 INFO DAGScheduler: Job 0 finished: show at PontusCassandra2HDFSJobHandler.scala:42, took 4.044479 s</span><br><span class="line">+---------+--------+-----+</span><br><span class="line">|   center|products|total|</span><br><span class="line">+---------+--------+-----+</span><br><span class="line">|  Sevilla|      28| 3200|</span><br><span class="line">| Valencia|      23| 3300|</span><br><span class="line">|   Bilbao|      25| 2500|</span><br><span class="line">|   Madrid|      51| 7700|</span><br><span class="line">|Barcelona|      47| 6400|</span><br><span class="line">+---------+--------+-----+</span><br></pre></td></tr></table></figure>
<p>上面的Spark作业会将Parquet文件写入HDFS的根路径，可以用spark-shell测试读取parquet文件。</p>
<p>Spark作业执行页面：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161125100527204" alt="pontus-spark"></p>
<p>Pontus作业执行成功页面：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161125100553908" alt="pontus-job"></p>
<p>HDFS追加作业：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20161129174641219" alt="hdfs"></p>
<p>空值问题：解决办法：Option</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">play.api.http.HttpErrorHandlerExceptions$$anon$1: Execution exception[[RuntimeException: ColumnName(PONTUS_EXECUTION.LOGOUT,Some(LOGOUT))]]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:293)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:220)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at util.Global$.onError(Global.scala:8)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br><span class="line">Caused by: java.lang.RuntimeException: ColumnName(PONTUS_EXECUTION.LOGOUT,Some(LOGOUT))</span><br><span class="line">  at scala.sys.package$.error(package.scala:27)</span><br><span class="line">  at anorm.SqlRequestError$class.toFailure(Anorm.scala:20)</span><br><span class="line">  at anorm.UnexpectedNullableFound.toFailure(Anorm.scala:37)</span><br><span class="line">  at anorm.Sql$$anonfun$asTry$2$$anonfun$apply$7.apply(Anorm.scala:303)</span><br><span class="line">  at anorm.Sql$$anonfun$asTry$2$$anonfun$apply$7.apply(Anorm.scala:303)</span><br><span class="line">  at anorm.SqlResult$class.fold(SqlResult.scala:23)</span><br><span class="line">  at anorm.Error.fold(SqlResult.scala:31)</span><br><span class="line">  at anorm.Sql$$anonfun$asTry$2.apply(Anorm.scala:303)</span><br><span class="line">  at anorm.Sql$$anonfun$asTry$2.apply(Anorm.scala:303)</span><br><span class="line">  at scala.util.Success.flatMap(Try.scala:231)</span><br></pre></td></tr></table></figure>
<h2 id="预览">预览</h2><p><a href="http://192.168.6.53:9000/preview/HDFS/%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="noopener">http://192.168.6.53:9000/preview/HDFS/%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<p><a href="http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2F192.168.6.52:9000%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="noopener">http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2F192.168.6.52:9000%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<p><a href="http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2Ftdfs%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15" target="_blank" rel="noopener">http://192.168.6.53:9000/preview/HDFS/hdfs:%2F%2Ftdfs%2Fuser%2Ftongdun%2Fpontus%2Fantifraud%2Ffeedback%2Fyear=2016%2Fmonth=12%2Fday=15</a></p>
<h2 id="Actor">Actor</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SparkJobActor preStart().............</span><br><span class="line">PontusSchedule(1,1,qihuang.zheng,2016-11-29 21:10:00.0,5d)</span><br><span class="line">[warn] o.a.h.u.NativeCodeLoader - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable</span><br><span class="line">Global onStart().............</span><br><span class="line">mode:demo</span><br><span class="line">PontusSchedule(1,1,qihuang.zheng,2016-11-29 21:10:00.0,5d)</span><br><span class="line">[info] play.api.Play - Application started (Dev)</span><br></pre></td></tr></table></figure>
<h2 id="Quartz">Quartz</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.quartz.JobBuilder._</span><br><span class="line">import org.quartz.TriggerBuilder._</span><br><span class="line">import org.quartz.SimpleScheduleBuilder._</span><br><span class="line">import org.quartz.CronScheduleBuilder._</span><br><span class="line">import org.quartz.CalendarIntervalScheduleBuilder._</span><br><span class="line">import org.quartz.JobKey._</span><br><span class="line">import org.quartz.TriggerKey._</span><br><span class="line">import org.quartz.DateBuilder._</span><br><span class="line">import org.quartz.impl.matchers.KeyMatcher._</span><br><span class="line">import org.quartz.impl.matchers.GroupMatcher._</span><br><span class="line">import org.quartz.impl.matchers.AndMatcher._</span><br><span class="line">import org.quartz.impl.matchers.OrMatcher._</span><br><span class="line">import org.quartz.impl.matchers.EverythingMatcher._</span><br></pre></td></tr></table></figure>
<h3 id="Job依赖注入">Job依赖注入</h3><p>Job注入其他实例报错无法实例化，那么如何注入DAO对象？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">class PontusSparkJob @Inject()(configuration: Configuration,</span><br><span class="line">                               executionRepository: ExecutionRepository,</span><br><span class="line">                               scheduleRepository: ScheduleRepository,</span><br><span class="line">                               jobRepository: JobRepository</span><br><span class="line">                              ) extends Job &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[error] o.q.c.ErrorLogger - An error occured instantiating job to be executed. job= &apos;Cassandra.pontusjob_1&apos;</span><br><span class="line">org.quartz.SchedulerException: Problem instantiating class &apos;schedule.PontusSparkJob&apos;</span><br><span class="line">  at org.quartz.simpl.SimpleJobFactory.newJob(SimpleJobFactory.java:58)</span><br><span class="line">  at org.quartz.simpl.PropertySettingJobFactory.newJob(PropertySettingJobFactory.java:69)</span><br><span class="line">  at org.quartz.core.JobRunShell.initialize(JobRunShell.java:127)</span><br><span class="line">  at org.quartz.core.QuartzSchedulerThread.run(QuartzSchedulerThread.java:375)</span><br><span class="line">Caused by: java.lang.InstantiationException: schedule.PontusSparkJob</span><br><span class="line">  at java.lang.Class.newInstance(Class.java:427)</span><br><span class="line">  at org.quartz.simpl.SimpleJobFactory.newJob(SimpleJobFactory.java:56)</span><br><span class="line">  ... 3 common frames omitted</span><br><span class="line">Caused by: java.lang.NoSuchMethodException: schedule.PontusSparkJob.&lt;init&gt;()</span><br><span class="line">  at java.lang.Class.getConstructor0(Class.java:3082)</span><br><span class="line">  at java.lang.Class.newInstance(Class.java:412)</span><br><span class="line">  ... 4 common frames omitted</span><br></pre></td></tr></table></figure>
<p>解决办法：启动时通过Global注册Application实例，在Job中通过Scheduler获取</p>
<figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">object</span> <span class="title">Global</span> <span class="keyword">extends</span> <span class="title">GlobalSettings</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">onStart</span></span>(application: play.api.<span class="type">Application</span>) &#123;</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.start()</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.getContext.put(<span class="string">"configuration"</span>, application.configuration)</span><br><span class="line">    schedule.<span class="type">PontusQuartzScheduler</span>.scheduler.getContext.put(<span class="string">"application"</span>, application)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PontusSparkJob</span> <span class="keyword">extends</span> <span class="title">Job</span> </span>&#123;</span><br><span class="line">  <span class="keyword">override</span> <span class="function"><span class="keyword">def</span> <span class="title">execute</span></span>(context: <span class="type">JobExecutionContext</span>): <span class="type">Unit</span> = &#123;</span><br><span class="line">    <span class="keyword">val</span> application = context.getScheduler.getContext.get(<span class="string">"application"</span>).asInstanceOf[<span class="type">Application</span>]</span><br><span class="line">    <span class="keyword">val</span> configuration = context.getScheduler.getContext.get(<span class="string">"configuration"</span>).asInstanceOf[<span class="type">Configuration</span>]</span><br><span class="line">    <span class="keyword">val</span> jobRepository = application.injector.instanceOf(classOf[<span class="type">JobRepository</span>])</span><br><span class="line">    <span class="keyword">val</span> executionRepository = application.injector.instanceOf(classOf[<span class="type">ExecutionRepository</span>])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">val</span> jobId = context.getMergedJobDataMap.getString(<span class="string">"jobId"</span>).toLong</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TODO：自定义JobFactory</p>
<p>mesos任务报错，页面会显示申请不到资源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">I1205 15:15:20.217545 19517 exec.cpp:143] Version: 0.28.2</span><br><span class="line">I1205 15:15:20.243422 19521 exec.cpp:217] Executor registered on slave 475189a7-dcde-4859-9af8-6fc2e63be94e-S0</span><br><span class="line">Unrecognized VM option &apos;UseCompressedStrings&apos;</span><br><span class="line">Error: Could not create the Java Virtual Machine.</span><br><span class="line">Error: A fatal exception has occurred. Program will exit.</span><br></pre></td></tr></table></figure>
<p>去掉spark中executor的jvm配置</p>
<h3 id="Quartz作业的自动重启">Quartz作业的自动重启</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">创建时：</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP | JOB_NAME    | JOB_GROUP | DESCRIPTION | NEXT_FIRE_TIME | PREV_FIRE_TIME | PRIORITY | TRIGGER_STATE | TRIGGER_TYPE | START_TIME    | END_TIME | CALENDAR_NAME | MISFIRE_INSTR | JOB_DATA |</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra     | pontusjob_1 | Cassandra | NULL        |  1480523100000 |  1480519500000 |        5 | WAITING       | SIMPLE       | 1480515900000 |        0 | NULL          |             1 |          |</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">1 row in set (10.33 sec)</span><br><span class="line"></span><br><span class="line">创建时间（START_TIME）：         1480515900000 - 2016年11月30日 星期三 22时25分00秒 CST</span><br><span class="line">第一次执行时间（PREV_FIRE_TIME）：1480519500000 - 2016年11月30日 星期三 23时25分00秒 CST</span><br><span class="line">下一次执行时间（NEXT_FIRE_TIME）：1480523100000 - 2016年12月 1日 星期四 00时25分00秒 CST</span><br><span class="line"></span><br><span class="line">停止服务器</span><br><span class="line"></span><br><span class="line">第二天早上重启，重启后如果没有访问页面，仍然不会调度，但是只要登录，就会开始调度</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP | JOB_NAME    | JOB_GROUP | DESCRIPTION | NEXT_FIRE_TIME | PREV_FIRE_TIME | PRIORITY | TRIGGER_STATE | TRIGGER_TYPE | START_TIME    | END_TIME | CALENDAR_NAME | MISFIRE_INSTR | JOB_DATA |</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra     | pontusjob_1 | Cassandra | NULL        |  1480561432130 |  1480557832130 |        5 | WAITING       | SIMPLE       | 1480557832130 |        0 | NULL          |             1 |          |</span><br><span class="line">+-----------------+--------------+---------------+-------------+-----------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">START_TIME：     1480557832130 - 2016年12月 1日 星期四 10时03分52秒 CST</span><br><span class="line">PREV_FIRE_TIME： 1480557832130 - 2016年12月 1日 星期四 10时03分52秒 CST</span><br><span class="line">NEXT_FIRE_TIME： 1480561432130 - 2016年12月 1日 星期四 11时03分52秒 CST</span><br></pre></td></tr></table></figure>
<p>相同Job不允许同时有两个Trigger在运行。解决办法：可以设置不同的JobId。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">! @729o8hm27 - Internal server error, for (GET) [/job/execute/Cassandra/HDFS/2] -&gt;</span><br><span class="line"></span><br><span class="line">play.api.UnexpectedException: Unexpected exception[ObjectAlreadyExistsException: Unable to store Job : &apos;Cassandra-HDFS.pontusjob_2&apos;, because one already exists with this identification.]</span><br><span class="line">  at play.api.http.HttpErrorHandlerExceptions$.throwableToUsefulException(HttpErrorHandler.scala:289)</span><br><span class="line">  at play.api.http.DefaultHttpErrorHandler.onServerError(HttpErrorHandler.scala:220)</span><br><span class="line">  at play.api.GlobalSettings$class.onError(GlobalSettings.scala:160)</span><br><span class="line">  at util.Global$.onError(Global.scala:23)</span><br><span class="line">  at play.api.http.GlobalSettingsHttpErrorHandler.onServerError(HttpErrorHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:100)</span><br><span class="line">  at play.core.server.netty.PlayRequestHandler$$anonfun$2$$anonfun$apply$1.applyOrElse(PlayRequestHandler.scala:99)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:344)</span><br><span class="line">  at scala.concurrent.Future$$anonfun$recoverWith$1.apply(Future.scala:343)</span><br><span class="line">  at scala.concurrent.impl.CallbackRunnable.run(Promise.scala:32)</span><br><span class="line">Caused by: org.quartz.ObjectAlreadyExistsException: Unable to store Job : &apos;Cassandra-HDFS.pontusjob_2&apos;, because one already exists with this identification.</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport.storeJob(JobStoreSupport.java:1108)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport$2.executeVoid(JobStoreSupport.java:1062)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport$VoidTransactionCallback.execute(JobStoreSupport.java:3715)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport$VoidTransactionCallback.execute(JobStoreSupport.java:3713)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport.executeInNonManagedTXLock(JobStoreSupport.java:3799)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreTX.executeInLock(JobStoreTX.java:93)</span><br><span class="line">  at org.quartz.impl.jdbcjobstore.JobStoreSupport.storeJobAndTrigger(JobStoreSupport.java:1058)</span><br><span class="line">  at org.quartz.core.QuartzScheduler.scheduleJob(QuartzScheduler.java:886)</span><br><span class="line">  at org.quartz.impl.StdScheduler.scheduleJob(StdScheduler.java:249)</span><br><span class="line">  at controllers.PontusJobController$$anonfun$execute$1.apply(PontusJobController.scala:72)</span><br></pre></td></tr></table></figure>
<p>spark streaming一次性作业：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | JOB_NAME     | JOB_GROUP      | DESCRIPTION | NEXT_FIRE_TIME | PREV_FIRE_TIME | PRIORITY | TRIGGER_STATE | TRIGGER_TYPE | START_TIME    | END_TIME | CALENDAR_NAME | MISFIRE_INSTR | JOB_DATA |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| QuartzScheduler | trigger1_2   | Kafka-HDFS     | pontusjob1_2 | Kafka-HDFS     | NULL        |             -1 |  1481165690342 |        5 | COMPLETE      | SIMPLE       | 1481165690342 |        0 | NULL          |             0 |          |</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra-HDFS | pontusjob2_1 | Cassandra-HDFS | NULL        |  1481165913700 |  1481165433700 |        5 | WAITING       | SIMPLE       | 1481103993700 |        0 | NULL          |             1 |          |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">2 rows in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | REPEAT_COUNT | REPEAT_INTERVAL | TIMES_TRIGGERED |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">| QuartzScheduler | trigger1_2   | Kafka-HDFS     |            0 |               0 |               1 |</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra-HDFS |           -1 |          480000 |             129 |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">2 rows in set (0.00 sec)</span><br></pre></td></tr></table></figure>
<p>过了会儿，一次性的任务信息会从Quartz删除，但是实际上spark streaming还在运行！<br>这时，如果再次点击执行，虽然triggerKey不存在，但是也不应该允许再次执行！否则就会存在两个spark streaming程序！<br>还有一个问题：由于spark streaming不会结束，所以无法看到日志，状态也永远是正在执行。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select * from QRTZ_SIMPLE_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | REPEAT_COUNT | REPEAT_INTERVAL | TIMES_TRIGGERED |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra-HDFS |           -1 |          480000 |             129 |</span><br><span class="line">+-----------------+--------------+----------------+--------------+-----------------+-----------------+</span><br><span class="line">1 row in set (0.01 sec)</span><br><span class="line"></span><br><span class="line">mysql&gt; select * from QRTZ_TRIGGERS;</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| SCHED_NAME      | TRIGGER_NAME | TRIGGER_GROUP  | JOB_NAME     | JOB_GROUP      | DESCRIPTION | NEXT_FIRE_TIME | PREV_FIRE_TIME | PRIORITY | TRIGGER_STATE | TRIGGER_TYPE | START_TIME    | END_TIME | CALENDAR_NAME | MISFIRE_INSTR | JOB_DATA |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">| QuartzScheduler | trigger2_1   | Cassandra-HDFS | pontusjob2_1 | Cassandra-HDFS | NULL        |  1481165913700 |  1481165433700 |        5 | WAITING       | SIMPLE       | 1481103993700 |        0 | NULL          |             1 |          |</span><br><span class="line">+-----------------+--------------+----------------+--------------+----------------+-------------+----------------+----------------+----------+---------------+--------------+---------------+----------+---------------+---------------+----------+</span><br><span class="line">1 row in set (0.01 sec)</span><br></pre></td></tr></table></figure>
<h2 id="Kafka">Kafka</h2><p>创建测试主题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">bin/kafka-topics.sh --create --zookeeper 192.168.6.55:2181 --replication-factor 1 --partitions 1 --topic graylog_nginx</span><br><span class="line">bin/kafka-console-producer.sh --broker-list 192.168.6.55:9092,192.168.6.56:9092,192.168.6.57:9092 --topic graylog_nginx</span><br><span class="line">bin/kafka-console-consumer.sh --zookeeper 192.168.6.55:2181 --topic graylog_nginx --from-beginning</span><br></pre></td></tr></table></figure>
<p>准备json数据</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">1</span>,<span class="attr">"name"</span>:<span class="string">"Betty"</span>,<span class="attr">"email"</span>:<span class="string">"bsmithrl@simplemachines.org"</span>,<span class="attr">"city"</span>:<span class="string">"Eláteia"</span>,<span class="attr">"country"</span>:<span class="string">"Greece"</span>,<span class="attr">"ip"</span>:<span class="string">"9.19.204.44"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">2</span>,<span class="attr">"name"</span>:<span class="string">"Anna"</span>,<span class="attr">"email"</span>:<span class="string">"alewisrm@canalblog.com"</span>,<span class="attr">"city"</span>:<span class="string">"Shangjing"</span>,<span class="attr">"country"</span>:<span class="string">"China"</span>,<span class="attr">"ip"</span>:<span class="string">"14.207.119.126"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">3</span>,<span class="attr">"name"</span>:<span class="string">"David"</span>,<span class="attr">"email"</span>:<span class="string">"dgarrettrn@japanpost.jp"</span>,<span class="attr">"city"</span>:<span class="string">"Tsarychanka"</span>,<span class="attr">"country"</span>:<span class="string">"Ukraine"</span>,<span class="attr">"ip"</span>:<span class="string">"111.252.63.159"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">4</span>,<span class="attr">"name"</span>:<span class="string">"Heather"</span>,<span class="attr">"email"</span>:<span class="string">"hgilbertro@skype.com"</span>,<span class="attr">"city"</span>:<span class="string">"Koilás"</span>,<span class="attr">"country"</span>:<span class="string">"Greece"</span>,<span class="attr">"ip"</span>:<span class="string">"29.57.181.250"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">5</span>,<span class="attr">"name"</span>:<span class="string">"Diane"</span>,<span class="attr">"email"</span>:<span class="string">"ddanielsrp@statcounter.com"</span>,<span class="attr">"city"</span>:<span class="string">"Mapiripán"</span>,<span class="attr">"country"</span>:<span class="string">"Colombia"</span>,<span class="attr">"ip"</span>:<span class="string">"19.205.181.99"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">6</span>,<span class="attr">"name"</span>:<span class="string">"Philip"</span>,<span class="attr">"email"</span>:<span class="string">"pfullerrq@reuters.com"</span>,<span class="attr">"city"</span>:<span class="string">"El Cairo"</span>,<span class="attr">"country"</span>:<span class="string">"Colombia"</span>,<span class="attr">"ip"</span>:<span class="string">"210.248.121.194"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">7</span>,<span class="attr">"name"</span>:<span class="string">"Maria"</span>,<span class="attr">"email"</span>:<span class="string">"mfordrr@shop-pro.jp"</span>,<span class="attr">"city"</span>:<span class="string">"Karabash"</span>,<span class="attr">"country"</span>:<span class="string">"Russia"</span>,<span class="attr">"ip"</span>:<span class="string">"224.21.41.52"</span>&#125;</span><br><span class="line"></span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">8</span>,<span class="attr">"username"</span>:<span class="string">"Bety"</span>,<span class="attr">"email"</span>:<span class="string">"bsmithrl@simplemachines.org"</span>,<span class="attr">"city"</span>:<span class="string">"Eláteia"</span>,<span class="attr">"country"</span>:<span class="string">"Greece"</span>,<span class="attr">"ipAddress"</span>:<span class="string">"9.19.204.44"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">9</span>,<span class="attr">"username"</span>:<span class="string">"Ana"</span>,<span class="attr">"email"</span>:<span class="string">"alewisrm@canalblog.com"</span>,<span class="attr">"city"</span>:<span class="string">"Shangjing"</span>,<span class="attr">"country"</span>:<span class="string">"China"</span>,<span class="attr">"ipAddress"</span>:<span class="string">"14.207.119.126"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">10</span>,<span class="attr">"username"</span>:<span class="string">"David"</span>,<span class="attr">"email"</span>:<span class="string">"dgarrettrn@japanpost.com"</span>,<span class="attr">"city"</span>:<span class="string">"Tsarychanka"</span>,<span class="attr">"country"</span>:<span class="string">"Ukraine"</span>,<span class="attr">"ipAddress"</span>:<span class="string">"111.252.63.159"</span>&#125;</span><br><span class="line">&#123;<span class="attr">"id"</span>:<span class="number">11</span>,<span class="attr">"name"</span>:<span class="string">"Calis"</span>,<span class="attr">"email"</span>:<span class="string">"carlis@google.com"</span>,<span class="attr">"city"</span>:<span class="string">"Koran"</span>,<span class="attr">"country"</span>:<span class="string">"Greece"</span>,<span class="attr">"ip"</span>:<span class="string">"29.57.181.250"</span>&#125;</span><br></pre></td></tr></table></figure>
<h1 id="附录">附录</h1><h2 id="sbt私服">sbt私服</h2><p>安装repox：<a href="https://github.com/Centaur/repox/wiki">https://github.com/Centaur/repox/wiki</a><br>可以在本机开发环境编译jar包，再上次到服务器（因为服务器上可能没有编译所需的node环境）。  </p>
<p>启动repox，然后打开：<a href="http://192.168.6.53:8078/admin/admin.html#/upstreams" target="_blank" rel="noopener">http://192.168.6.53:8078/admin/admin.html#/upstreams</a>，密码：zhimakaimen</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nohup java -Xmx512m -jar repox-assembly-0.1-SNAPSHOT.jar &amp;</span><br></pre></td></tr></table></figure>
<p>在<code>~/.sbt/repositories</code>添加两行配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repox-maven: http://192.168.6.53:8078/</span><br><span class="line">repox-ivy: http://192.168.6.53:8078/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext]</span><br></pre></td></tr></table></figure>
<p>完整的repositories文件：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[repositories]</span><br><span class="line">local</span><br><span class="line">local-maven: file:///Users/zhengqh/.m2/repository/</span><br><span class="line">repox-maven: http://192.168.6.53:8078/</span><br><span class="line">repox-ivy: http://192.168.6.53:8078/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext]</span><br><span class="line">#osc: http://maven.oschina.net/content/groups/public/</span><br><span class="line">#oschina-ivy: http://maven.oschina.net/content/groups/public/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext]</span><br><span class="line">typesafe: http://repo.typesafe.com/typesafe/ivy-releases/, [organization]/[module]/(scala_[scalaVersion]/)(sbt_[sbtVersion]/)[revision]/[type]s/[artifact](-[classifier]).[ext], bootOnly</span><br><span class="line">sonatype-oss-releases</span><br><span class="line">maven-central</span><br><span class="line">sonatype-oss-snapshots</span><br></pre></td></tr></table></figure>
<p>使用activator运行play时，创建activatorconfig.txt文件，添加以下配置：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ cat ~/.activator/activatorconfig.txt</span><br><span class="line">-Dsbt.override.build.repos=true</span><br></pre></td></tr></table></figure>
<p>命令行运行activator，如果出现<code>downloading http://192.168.6.53:8078</code>，表示私服搭建成功。<br>如果本地不存在jar包，则私服会自动下载，然后再下载到本地。  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">➜  first-player git:(master) ✗ ./activator run</span><br><span class="line">[info] Loading global plugins from /Users/zhengqh/.sbt/0.13/plugins</span><br><span class="line">[info] Loading project definition from /Users/zhengqh/Github/first-player/project</span><br><span class="line">[info] Updating &#123;file:/Users/zhengqh/Github/first-player/project/&#125;first-player-build...</span><br><span class="line">[info] Resolving org.fusesource.jansi#jansi;1.4 ...</span><br><span class="line">[info] downloading http://192.168.6.53:8078/com.typesafe.play/sbt-plugin/scala_2.10/sbt_0.13/2.5.10/jars/sbt-plugin.jar ...</span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play#sbt-plugin;2.5.10!sbt-plugin.jar (7242ms)</span><br><span class="line">[info] downloading http://192.168.6.53:8078/com/typesafe/play/sbt-routes-compiler_2.10/2.5.10/sbt-routes-compiler_2.10-2.5.10.jar ...</span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play#sbt-routes-compiler_2.10;2.5.10!sbt-routes-compiler_2.10.jar (9753ms)</span><br><span class="line">[info] downloading http://192.168.6.53:8078/com/typesafe/play/sbt-run-support_2.10/2.5.10/sbt-run-support_2.10-2.5.10.jar ...</span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play#sbt-run-support_2.10;2.5.10!sbt-run-support_2.10.jar (6686ms)</span><br><span class="line">[info] downloading http://192.168.6.53:8078/com/typesafe/play/build-link/2.5.10/build-link-2.5.10.jar ...</span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play#build-link;2.5.10!build-link.jar (6589ms)</span><br><span class="line">[info] downloading http://192.168.6.53:8078/com/typesafe/play/play-exceptions/2.5.10/play-exceptions-2.5.10.jar ...</span><br><span class="line">[info]  [SUCCESSFUL ] com.typesafe.play#play-exceptions;2.5.10!play-exceptions.jar (2358ms)</span><br><span class="line">[info] Done updating.</span><br></pre></td></tr></table></figure>
<p>使用sbt运行时（sbt run），需要更改sbt的选项，比如下面是mac环境使用brew安装sbt配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ cat /usr/local/bin/sbt</span><br><span class="line">#!/bin/sh</span><br><span class="line">export SBT_OPTS=&quot;-Dsbt.override.build.repos=true&quot;</span><br><span class="line">if [ -f &quot;$HOME/.sbtconfig&quot; ]; then</span><br><span class="line">  echo &quot;Use of ~/.sbtconfig is deprecated, please migrate global settings to /usr/local/etc/sbtopts&quot; &gt;&amp;2</span><br><span class="line">  . &quot;$HOME/.sbtconfig&quot;</span><br><span class="line">fi</span><br><span class="line">exec &quot;/usr/local/Cellar/sbt/0.13.8/libexec/sbt&quot; &quot;$@&quot;</span><br></pre></td></tr></table></figure>
<p>IDEA开发环境，还需要配置：</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512105246182" alt="3"></p>
<h2 id="Play_MultiProject">Play MultiProject</h2><p>参考：<a href="https://github.com/aaronp/multi-project">https://github.com/aaronp/multi-project</a></p>
<p>增加play后，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: org.slf4j.helpers.NOPLoggerFactory cannot be cast to ch.qos.logback.classic.LoggerContext</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.configure(LogbackLoggerConfigurator.scala:80)</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.init(LogbackLoggerConfigurator.scala:26)</span><br><span class="line">  at play.core.server.DevServerStart$$anonfun$mainDev$1.apply(DevServerStart.scala:94)</span><br><span class="line">  at play.core.server.DevServerStart$$anonfun$mainDev$1.apply(DevServerStart.scala:65)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:21)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDev(DevServerStart.scala:64)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDevHttpMode(DevServerStart.scala:54)</span><br><span class="line">  at play.core.server.DevServerStart.mainDevHttpMode(DevServerStart.scala)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">  at java.lang.reflect.Method.invoke(Method.java:497)</span><br><span class="line">  at play.runsupport.Reloader$.startDevMode(Reloader.scala:207)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.devModeServer$lzycompute$1(PlayRun.scala:73)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.play$sbt$run$PlayRun$$anonfun$$anonfun$$anonfun$$devModeServer$1(PlayRun.scala:73)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.apply(PlayRun.scala:99)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.apply(PlayRun.scala:52)</span><br><span class="line">  at scala.Function1$$anonfun$compose$1.apply(Function1.scala:47)</span><br><span class="line">[trace] Stack trace suppressed: run last web/compile:run for the full output.</span><br><span class="line">[error] (web/compile:run) java.lang.reflect.InvocationTargetException</span><br><span class="line">[error] Total time: 37 s, completed 2017-3-8 20:28:39</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: org.slf4j.impl.Log4jLoggerFactory cannot be cast to ch.qos.logback.classic.LoggerContext</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.configure(LogbackLoggerConfigurator.scala:80)</span><br><span class="line">  at play.api.libs.logback.LogbackLoggerConfigurator.init(LogbackLoggerConfigurator.scala:26)</span><br><span class="line">  at play.core.server.DevServerStart$$anonfun$mainDev$1.apply(DevServerStart.scala:94)</span><br><span class="line">  at play.core.server.DevServerStart$$anonfun$mainDev$1.apply(DevServerStart.scala:65)</span><br><span class="line">  at play.utils.Threads$.withContextClassLoader(Threads.scala:21)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDev(DevServerStart.scala:64)</span><br><span class="line">  at play.core.server.DevServerStart$.mainDevHttpMode(DevServerStart.scala:54)</span><br><span class="line">  at play.core.server.DevServerStart.mainDevHttpMode(DevServerStart.scala)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">  at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">  at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">  at java.lang.reflect.Method.invoke(Method.java:497)</span><br><span class="line">  at play.runsupport.Reloader$.startDevMode(Reloader.scala:234)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.devModeServer$lzycompute$1(PlayRun.scala:74)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.play$sbt$run$PlayRun$$anonfun$$anonfun$$anonfun$$devModeServer$1(PlayRun.scala:74)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.apply(PlayRun.scala:100)</span><br><span class="line">  at play.sbt.run.PlayRun$$anonfun$playRunTask$1$$anonfun$apply$2$$anonfun$apply$3.apply(PlayRun.scala:53)</span><br><span class="line">  at scala.Function1$$anonfun$compose$1.apply(Function1.scala:47)</span><br><span class="line">[trace] Stack trace suppressed: run last web/compile:run for the full output.</span><br><span class="line">[error] (web/compile:run) java.lang.reflect.InvocationTargetException</span><br><span class="line">[error] Total time: 3 s, completed 2017-3-8 20:16:56</span><br></pre></td></tr></table></figure>
<p>解决方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">val webExcludeDependencies = Seq(</span><br><span class="line">  SbtExclusionRule(&quot;org.slf4j&quot; ,&quot;slf4j-simple&quot;),</span><br><span class="line">  SbtExclusionRule(&quot;org.slf4j&quot;, &quot;slf4j-jdk12&quot;) ,</span><br><span class="line">  SbtExclusionRule(&quot;org.slf4j&quot;, &quot;slf4j-log4j12&quot;)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h2 id="Run_&amp;_Debug_With_IDEA">Run &amp; Debug With IDEA</h2><p>参考：<a href="http://stackoverflow.com/questions/24218341/how-to-run-play-framework-2-x-in-debug-mode-in-intellij-idea" target="_blank" rel="noopener">http://stackoverflow.com/questions/24218341/how-to-run-play-framework-2-x-in-debug-mode-in-intellij-idea</a><br><a href="http://stackoverflow.com/questions/22195364/debugging-sbt-project-with-play-in-intellij-idea" target="_blank" rel="noopener">http://stackoverflow.com/questions/22195364/debugging-sbt-project-with-play-in-intellij-idea</a><br><a href="http://stackoverflow.com/questions/4150776/debugging-scala-code-with-simple-build-tool-sbt-and-intellij" target="_blank" rel="noopener">http://stackoverflow.com/questions/4150776/debugging-scala-code-with-simple-build-tool-sbt-and-intellij</a></p>
<p>命令行运行： <code>sbt web/run -Dconfig.resource=local/application.zqh.conf -Dhttp.port=9091</code></p>
<h3 id="1-_Play_App（❌）">1. Play App（❌）</h3><p>IDEA中运行Play App，或者直接在Controller上右键点击Run Play 2 App</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512103522643" alt="1"></p>
<p>sbt多模块无法定位到web</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[info] Loading project definition from /Users/zhengqh/Github/pontus/project</span><br><span class="line">[info] Updating &#123;file:/Users/zhengqh/Github/pontus/project/&#125;pontus-build...</span><br><span class="line">[info] Compiling 3 Scala sources to /Users/zhengqh/Github/pontus/project/target/scala-2.10/sbt-0.13/classes...</span><br><span class="line">[info] Set current project to pontus-root (in build file:/Users/zhengqh/Github/pontus/)</span><br><span class="line">[warn] compile:run::javaOptions will be ignored, compile:run::fork is set to false</span><br><span class="line">java.lang.RuntimeException: No main class detected.</span><br><span class="line">  at scala.sys.package$.error(package.scala:27)</span><br><span class="line">[trace] Stack trace suppressed: run &apos;last root/compile:run&apos; for the full output.</span><br><span class="line">[error] (root/compile:run) No main class detected.</span><br><span class="line">[error] Total time: 0 s, completed 2017-5-12 10:35:01</span><br><span class="line">Disconnected from the target VM, address: &apos;127.0.0.1:62036&apos;, transport: &apos;socket&apos;</span><br></pre></td></tr></table></figure>
<p>只有Play工程，应该是可以的</p>
<h3 id="2-_Sbt_Task（✅）">2. Sbt Task（✅）</h3><p>IDEA中运行Sbt Task，注意-D参数必须添加到VM arguments，不能放在Tasks中</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512103539643" alt="2"></p>
<h3 id="3-_jvm-debug（✅）">3. jvm-debug（✅）</h3><p>Play工程的命令行执行方式：sbt -jvm-debug 9999 “run 9091”</p>
<p>Sbt多模块的命令行执行方式：sbt -jvm-debug 9999  web/run -Dconfig.resource=local/application.zqh.conf -Dhttp.port=9091</p>
<p>先在命令行启动sbt，然后在IDEA中配置Remote</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512104754468" alt="3"></p>
<p>用启动Remote的debug，设置断点，可以进入断点，控制器会打印</p>
<p>Connected to the target VM, address: ‘localhost:9999’, transport: ‘socket’</p>
<p>访问：<a href="http://localhost:9091/api/v1/job" target="_blank" rel="noopener">http://localhost:9091/api/v1/job</a> ，进入DEBUG模式</p>
<p><img src="https://images.weserv.nl/?url=http://img.blog.csdn.net/20170512105802005" alt="4"></p>

      
    </div>
    
  </div>
  
    
<div class="copyright">
  <p><span>本文标题:</span><a href="/2016/11/11/Play-Quickstart/">PlayFramework快速入门</a></p>
  <p><span>文章作者:</span><a href="/" title="访问 任何忧伤,都抵不过世界的美丽 的个人博客">任何忧伤,都抵不过世界的美丽</a></p>
  <p><span>发布时间:</span>2016年11月11日 - 00时00分</p>
  <p><span>最后更新:</span>2019年02月14日 - 21时42分</p>
  <p>
    <span>原始链接:</span><a href="/2016/11/11/Play-Quickstart/" title="PlayFramework快速入门">http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/</a>
    <span class="btn" data-clipboard-text="原文: http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/　　作者: 任何忧伤,都抵不过世界的美丽" title="点击复制文章链接">
        <i class="fa fa-clipboard"></i>
    </span>
  </p>
  <p><span>许可协议:</span><i class="fa fa-creative-commons"></i> <a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" title="中国大陆 (CC BY-NC-SA 3.0 CN)">"署名-非商用-相同方式共享 3.0"</a> 转载请保留原文链接及作者。</p>
  <script src="/js/clipboard.min.js"></script>
  <script> var clipboard = new Clipboard('.btn'); </script>
</div>
<style type="text/css">
  .copyright p .btn {
    margin-left: 1em;
  }
  .copyright:hover p .btn::after {
    content: "复制"
  }
  .copyright p .btn:hover {
      color: gray;
      cursor: pointer;
    };
</style>



<nav id="article-nav">
  
    <div id="article-nav-newer" class="article-nav-title">
      <a href="/2016/11/11/Data-Transform/">
        ETL Tools
      </a>
    </div>
  
  
    <div id="article-nav-older" class="article-nav-title">
      <a href="/2016/11/06/Kafka-Streams-blog/">
        Kafka Streams 博客
      </a>
    </div>
  
</nav>

  
  
    <div class="post-donate">
	<br>
	<p>
    <div id="donate_board" class="donate_bar center">
        <a id="btn_donate" class="btn_donate" href="javascript:;" title="打赏"></a>
        <span class="donate_txt">
           &uarr;<br>
		   招人广告：对蚂蚁金服中间件感兴趣的可以发邮件到：qihuang.zqh@antfin.com
        </span>
        <br>
    </div>  
	<div id="donate_guide" class="donate_bar center hidden">
		<img src="/img/zhifubao.png" alt="支付宝打赏"> 
		<img src="/img/weixin.png" alt="微信打赏">  
    </div>
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function(){
			$('#donate_board').addClass('hidden');
			$('#donate_guide').removeClass('hidden');
		}
	</script>
</p></div>
  
</article>

<!-- 默认显示文章目录，在文章---前输入toc: false关闭目录 -->
<!-- Show TOC and tocButton in default, Hide TOC via putting "toc: false" before "---" at [post].md -->
<div id="toc" class="toc-article">
<strong class="toc-title">文章目录</strong>
<ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#Run!_Run!!_Run!!!"><span class="toc-number">1.</span> <span class="toc-text">Run! Run!! Run!!!</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Hello_World!"><span class="toc-number">2.</span> <span class="toc-text">Hello World!</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#路由和Controller"><span class="toc-number">2.1.</span> <span class="toc-text">路由和Controller</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面和渲染"><span class="toc-number">2.2.</span> <span class="toc-text">页面和渲染</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#模板编译"><span class="toc-number">2.2.1.</span> <span class="toc-text">模板编译</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Products_Example"><span class="toc-number">3.</span> <span class="toc-text">Products Example</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#implicit"><span class="toc-number">3.1.</span> <span class="toc-text">implicit</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Spark集成"><span class="toc-number">4.</span> <span class="toc-text">Spark集成</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#play-spark-module"><span class="toc-number">4.1.</span> <span class="toc-text">play-spark-module</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark_Launcher"><span class="toc-number">4.2.</span> <span class="toc-text">Spark Launcher</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mesos"><span class="toc-number">4.2.1.</span> <span class="toc-text">mesos</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#问题"><span class="toc-number">4.2.2.</span> <span class="toc-text">问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Spark_Cassandra"><span class="toc-number">4.3.</span> <span class="toc-text">Spark Cassandra</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#预览"><span class="toc-number">4.4.</span> <span class="toc-text">预览</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Actor"><span class="toc-number">4.5.</span> <span class="toc-text">Actor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Quartz"><span class="toc-number">4.6.</span> <span class="toc-text">Quartz</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Job依赖注入"><span class="toc-number">4.6.1.</span> <span class="toc-text">Job依赖注入</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Quartz作业的自动重启"><span class="toc-number">4.6.2.</span> <span class="toc-text">Quartz作业的自动重启</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Kafka"><span class="toc-number">4.7.</span> <span class="toc-text">Kafka</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#附录"><span class="toc-number">5.</span> <span class="toc-text">附录</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#sbt私服"><span class="toc-number">5.1.</span> <span class="toc-text">sbt私服</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Play_MultiProject"><span class="toc-number">5.2.</span> <span class="toc-text">Play MultiProject</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Run_&_Debug_With_IDEA"><span class="toc-number">5.3.</span> <span class="toc-text">Run &amp; Debug With IDEA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-_Play_App（❌）"><span class="toc-number">5.3.1.</span> <span class="toc-text">1. Play App（❌）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-_Sbt_Task（✅）"><span class="toc-number">5.3.2.</span> <span class="toc-text">2. Sbt Task（✅）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-_jvm-debug（✅）"><span class="toc-number">5.3.3.</span> <span class="toc-text">3. jvm-debug（✅）</span></a></li></ol></li></ol></li></ol>
</div>
<style type="text/css">
  .left-col .switch-btn {
    display: none;
  }
  .left-col .switch-area {
    display: none;
  }
</style>

<input type="button" id="tocButton" value="隐藏目录" title="点击按钮隐藏或者显示文章目录">
<script type="text/javascript">
  var toc_button= document.getElementById("tocButton");
  var toc_div= document.getElementById("toc");
  /* Show or hide toc when click on tocButton.
  通过点击设置的按钮显示或者隐藏文章目录.*/
  toc_button.onclick=function(){
  if(toc_div.style.display=="none"){
  toc_div.style.display="block";
  toc_button.value="隐藏目录";
  document.getElementById("switch-btn").style.display="none";
  document.getElementById("switch-area").style.display="none";
  }
  else{
  toc_div.style.display="none";
  toc_button.value="显示目录";
  document.getElementById("switch-btn").style.display="block";
  document.getElementById("switch-area").style.display="block";
  }
  }
    if ($(".toc").length < 1) {
        $("#toc").css("display","none");
        $("#tocButton").css("display","none");
        $(".switch-btn").css("display","block");
        $(".switch-area").css("display","block");
    }
</script>


    <style>
        .toc {
            white-space: nowrap;
            overflow-x: hidden;
        }
    </style>

    <script>
        $(document).ready(function() {
            $(".toc li a").mouseover(function() {
                var title = $(this).attr('href');
                $(this).attr("title", title);
            });
        })
    </script>




<div class="share">
	<div class="bdsharebuttonbox">
	<a href="#" class="bds_more" data-cmd="more"></a>
	<a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
	<a href="#" class="bds_sqq" data-cmd="sqq" title="分享给 QQ 好友"></a>
	<a href="#" class="bds_copy" data-cmd="copy" title="复制网址"></a>
	<a href="#" class="bds_mail" data-cmd="mail" title="通过邮件分享"></a>
	<a href="#" class="bds_weixin" data-cmd="weixin" title="生成文章二维码"></a>
	</div>
	<script>
	window._bd_share_config={
		"common":{"bdSnsKey":{},"bdText":"","bdMini":"2","bdMiniList":false,"bdPic":"","bdStyle":"0","bdSize":"24"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];
	</script>
</div>



<div class="duoshuo" id="comments">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="2016/11/11/Play-Quickstart/" data-title="PlayFramework快速入门" data-url="http://github.com/zqhxuyuan/2016/11/11/Play-Quickstart/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"zqhxuyuan"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>






    <style type="text/css">
    #scroll {
      display: none;
    }
    </style>
    <div class="scroll">
    <a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
    <a href="#comments" title="查看评论"><i class="fa fa-comments-o"></i></a>
    <a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
    </div>


  
  
    
    <div class="post-nav-button">
    <a href="/2016/11/11/Data-Transform/" title="上一篇: ETL Tools">
    <i class="fa fa-angle-left"></i>
    </a>
    <a href="/2016/11/06/Kafka-Streams-blog/" title="下一篇: Kafka Streams 博客">
    <i class="fa fa-angle-right"></i>
    </a>
    </div>
  



    
        <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
        <script>
        var yiliaConfig = {
        fancybox: true,
        mathjax: true,
        animate: true,
        isHome: false,
        isPost: true,
        isArchive: false,
        isTag: false,
        isCategory: false,
        open_in_new: false
        }
        </script>
        
</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
      <div class="footer-left">
        &copy; 2019 任何忧伤,都抵不过世界的美丽
      </div>
        <div class="footer-right">
          <a href="http://hexo.io/" target="_blank" title="快速、简洁且高效的静态博客框架">Hexo</a>  Theme <a href="https://github.com/MOxFIVE/hexo-theme-yelee" target="_blank" title="简而不减双栏 Hexo 博客主题">Yelee</a> by MOxFIVE
        </div>
    </div>
    <div class="visit">
      <span id="busuanzi_container_site_pv" style="display:none">
        <span id="site-visit">本站到访数: 
        <span id="busuanzi_value_site_uv"></span>
        </span>
      </span>
      <span id="busuanzi_container_page_pv" style="display:none">
        <span id="page-visit">, 本页阅读量: 
        <span id="busuanzi_value_page_pv"></span>
        </span>
      </span>
    </div>
  </div>
</footer>
    </div>
    

<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js"></script>
<script src="/js/main.js"></script>

<script>
  var backgroundnum = 5;
  var backgroundimg = "url(/background/bg-x.jpg)".replace(/x/gi, Math.ceil(Math.random() * backgroundnum));

  $("body").css({"background": backgroundimg, "background-attachment": "fixed", "background-size": "cover"});
</script>


<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-80646710-1', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->



<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<div class="scroll" id="scroll">
<a href="#" title="返回顶部"><i class="fa fa-arrow-up"></i></a>
<a href="#footer" title="转到底部"><i class="fa fa-arrow-down"></i></a>
</div>

<script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js">
</script>
  </div>
</body>
</html>